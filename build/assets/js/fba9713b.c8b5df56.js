"use strict";(self.webpackChunkengine_docs=self.webpackChunkengine_docs||[]).push([[3766],{1386:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>m,frontMatter:()=>s,metadata:()=>r,toc:()=>d});var o=t(4848),i=t(8453);const s={},a=void 0,r={id:"Tutorials/Components/Core/Hider",title:"Hider",description:'window.open("https://thatopen.github.io/engine_components/examples/Hider")} >Go Full Screen',source:"@site/docs/Tutorials/Components/Core/Hider.mdx",sourceDirName:"Tutorials/Components/Core",slug:"/Tutorials/Components/Core/Hider",permalink:"/Tutorials/Components/Core/Hider",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Grids",permalink:"/Tutorials/Components/Core/Grids"},next:{title:"IDSSpecifications",permalink:"/Tutorials/Components/Core/IDSSpecifications"}},l={},d=[{value:"\ud83d\udcc4 Managing Items Visibility",id:"-managing-items-visibility",level:2},{value:"\ud83d\udd96 Importing our Libraries",id:"-importing-our-libraries",level:3},{value:"\ud83c\udf0e Setting up a Simple Scene",id:"-setting-up-a-simple-scene",level:3},{value:"\ud83d\udee0\ufe0f Setting Up Fragments",id:"\ufe0f-setting-up-fragments",level:3},{value:"\ud83d\udcc2 Loading Fragments Models",id:"-loading-fragments-models",level:3},{value:"\u2728 Using The Hider Component",id:"-using-the-hider-component",level:3},{value:"\ud83e\udde9 Adding some UI (optional but recommended)",id:"-adding-some-ui-optional-but-recommended",level:3},{value:"\u23f1\ufe0f Measuring the performance (optional)",id:"\ufe0f-measuring-the-performance-optional",level:3},{value:"\ud83c\udf89 Wrap up",id:"-wrap-up",level:3}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",hr:"hr",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{style:{position:"relative"},children:[(0,o.jsx)("iframe",{src:"https://thatopen.github.io/engine_components/examples/Hider"}),(0,o.jsx)("button",{class:"full-screen-btn",onClick:()=>window.open("https://thatopen.github.io/engine_components/examples/Hider"),children:"Go Full Screen"})]}),"\n",(0,o.jsx)(n.admonition,{title:"Source",type:"info",children:(0,o.jsxs)(n.p,{children:["Copying and pasting? We've got you covered! You can find the full source code of this tutorial ",(0,o.jsx)(n.a,{href:"https://github.com/ThatOpen/engine_components/blob/main/packages/core/src/fragments/Hider/example.ts",children:"here"}),"."]})}),"\n",(0,o.jsx)(n.h2,{id:"-managing-items-visibility",children:"\ud83d\udcc4 Managing Items Visibility"}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.p,{children:"Many times, we just want to look at a specific part of a BIM model, without seeing the rest of it. BIM models are complex, and finding what we are looking for is not always easy. Luckily, the components library has tools to make it easier!"}),"\n",(0,o.jsx)(n.h3,{id:"-importing-our-libraries",children:"\ud83d\udd96 Importing our Libraries"}),"\n",(0,o.jsx)(n.p,{children:"First things first, let's install all necessary dependencies to make this example work:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'import Stats from "stats.js";\nimport * as BUI from "@thatopen/ui";\n// You have to import * as OBC from "@thatopen/components"\nimport * as OBC from "../..";\n'})}),"\n",(0,o.jsx)(n.h3,{id:"-setting-up-a-simple-scene",children:"\ud83c\udf0e Setting up a Simple Scene"}),"\n",(0,o.jsx)(n.p,{children:"To get started, let's set up a basic ThreeJS scene. This will serve as the foundation for our application and allow us to visualize the 3D models effectively:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'const components = new OBC.Components();\n\nconst worlds = components.get(OBC.Worlds);\nconst world = worlds.create<\n  OBC.SimpleScene,\n  OBC.OrthoPerspectiveCamera,\n  OBC.SimpleRenderer\n>();\n\nworld.scene = new OBC.SimpleScene(components);\nworld.scene.setup();\nworld.scene.three.background = null;\n\nconst container = document.getElementById("container")!;\nworld.renderer = new OBC.SimpleRenderer(components, container);\nworld.camera = new OBC.OrthoPerspectiveCamera(components);\nawait world.camera.controls.setLookAt(78, 20, -2.2, 26, -4, 25);\n\ncomponents.init();\n'})}),"\n",(0,o.jsx)(n.h3,{id:"\ufe0f-setting-up-fragments",children:"\ud83d\udee0\ufe0f Setting Up Fragments"}),"\n",(0,o.jsx)(n.p,{children:"Now, let's configure the FragmentsManager. This will allow us to load models effortlessly and start manipulating them with ease:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'const workerUrl =\n  "https://thatopen.github.io/engine_fragment/resources/worker.mjs";\nconst fragments = components.get(OBC.FragmentsManager);\nfragments.init(workerUrl);\n\nworld.camera.controls.addEventListener("rest", () =>\n  fragments.core.update(true),\n);\n\nworld.onCameraChanged.add((camera) => {\n  for (const [, model] of fragments.list) {\n    model.useCamera(camera.three);\n  }\n  fragments.core.update(true);\n});\n\nfragments.list.onItemSet.add(({ value: model }) => {\n  model.useCamera(world.camera.three);\n  world.scene.three.add(model.object);\n  fragments.core.update(true);\n});\n'})}),"\n",(0,o.jsx)(n.h3,{id:"-loading-fragments-models",children:"\ud83d\udcc2 Loading Fragments Models"}),"\n",(0,o.jsx)(n.p,{children:"With the core setup complete, it's time to load a Fragments model into our scene. Fragments are optimized for fast loading and rendering, making them ideal for large-scale 3D models."}),"\n",(0,o.jsx)(n.admonition,{title:"Where can I find Fragment files?",type:"info",children:(0,o.jsx)(n.p,{children:"You can use the sample Fragment files available in our repository for testing. If you have an IFC model you'd like to convert to Fragments, check out the IfcImporter tutorial for detailed instructions."})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'const fragPaths = [\n  "https://thatopen.github.io/engine_components/resources/frags/school_arq.frag",\n  "https://thatopen.github.io/engine_components/resources/frags/school_str.frag",\n];\n\nawait Promise.all(\n  fragPaths.map(async (path) => {\n    const modelId = path.split("/").pop()?.split(".").shift();\n    if (!modelId) return null;\n    const file = await fetch(path);\n    const buffer = await file.arrayBuffer();\n    return fragments.core.load(buffer, { modelId });\n  }),\n);\n'})}),"\n",(0,o.jsx)(n.h3,{id:"-using-the-hider-component",children:"\u2728 Using The Hider Component"}),"\n",(0,o.jsx)(n.p,{children:"The Hider component is very handy, as it is the main tool used for isolating, hiding, or performing any other operation related to item visibility. First of all, let's get the instance:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"const hider = components.get(OBC.Hider);\n"})}),"\n",(0,o.jsx)(n.p,{children:"Starting with isolation, let's create a handy function that let's isolate items based on the category:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"const isolateByCategory = async (categories: string[]) => {\n  // An OBC.ModelIdMap represents selections within the engine.\n  // Here, we are defining a selection of the loaded model\n  // that includes all items belonging to the specified category.\n  const modelIdMap: OBC.ModelIdMap = {};\n\n  const categoriesRegex = categories.map((cat) => new RegExp(`^${cat}$`));\n\n  for (const [, model] of fragments.list) {\n    const items = await model.getItemsOfCategories(categoriesRegex);\n    const localIds = Object.values(items).flat();\n    modelIdMap[model.modelId] = new Set(localIds);\n  }\n  await hider.isolate(modelIdMap);\n};\n"})}),"\n",(0,o.jsx)(n.admonition,{title:"Multi-Model Compatibility",type:"note",children:(0,o.jsx)(n.p,{children:"You don't need to worry about making the Hider component work with multiple models, it handles this automatically (as do all other components) using the modelIdMap."})}),"\n",(0,o.jsx)(n.p,{children:"As you can see, it's quite straightforward. Now, let's create another helper function to hide items instead of isolating them:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"const hideByCategory = async (categories: string[]) => {\n  const modelIdMap: OBC.ModelIdMap = {};\n\n  const categoriesRegex = categories.map((cat) => new RegExp(`^${cat}$`));\n\n  for (const [, model] of fragments.list) {\n    const items = await model.getItemsOfCategories(categoriesRegex);\n    const localIds = Object.values(items).flat();\n    modelIdMap[model.modelId] = new Set(localIds);\n  }\n\n  await hider.set(false, modelIdMap);\n};\n"})}),"\n",(0,o.jsx)(n.admonition,{title:"Working with ModelIdMaps",type:"tip",children:(0,o.jsx)(n.p,{children:"Managing the visibility with ModelIdMaps (selections in That Open Engine) becomes very powerful when combined with other components, such as the ItemsFinder. Check out the tutorial for that component!"})}),"\n",(0,o.jsx)(n.p,{children:"Finally, you can easily reset the visibility of all items as follows:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"const resetVisibility = async () => {\n  await hider.set(true);\n};\n"})}),"\n",(0,o.jsx)(n.h3,{id:"-adding-some-ui-optional-but-recommended",children:"\ud83e\udde9 Adding some UI (optional but recommended)"}),"\n",(0,o.jsxs)(n.p,{children:["We will use the ",(0,o.jsx)(n.code,{children:"@thatopen/ui"})," library to add some simple and cool UI elements to our app. First, we need to call the ",(0,o.jsx)(n.code,{children:"init"})," method of the ",(0,o.jsx)(n.code,{children:"BUI.Manager"})," class to initialize the library:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"BUI.Manager.init();\n"})}),"\n",(0,o.jsx)(n.p,{children:"Now we will add some UI to play around with the actions in this tutorial. For more information about the UI library, you can check the specific documentation for it!"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'const categoriesDropdownTemplate = () => {\n  const onCreated = async (e?: Element) => {\n    if (!e) return;\n\n    const dropdown = e as BUI.Dropdown;\n\n    const modelCategories = new Set<string>();\n    for (const [, model] of fragments.list) {\n      const categories = await model.getItemsWithGeometryCategories();\n      for (const category of categories) {\n        if (!category) continue;\n        modelCategories.add(category);\n      }\n    }\n\n    for (const category of modelCategories) {\n      const option = BUI.Component.create(\n        () => BUI.html`<bim-option label=${category}></bim-option>`,\n      );\n      dropdown.append(option);\n    }\n  };\n\n  return BUI.html`\n    <bim-dropdown multiple ${BUI.ref(onCreated)}></bim-dropdown>\n  `;\n};\n\nconst panel = BUI.Component.create<BUI.PanelSection>(() => {\n  const categoriesDropdownA = BUI.Component.create<BUI.Dropdown>(\n    categoriesDropdownTemplate,\n  );\n\n  const categoriesDropdownB = BUI.Component.create<BUI.Dropdown>(\n    categoriesDropdownTemplate,\n  );\n\n  const onIsolateCategory = async ({ target }: { target: BUI.Button }) => {\n    if (!categoriesDropdownA) return;\n    const categories = categoriesDropdownA.value;\n    if (categories.length === 0) return;\n    target.loading = true;\n    await isolateByCategory(categories);\n    target.loading = false;\n  };\n\n  const onHideCategory = async ({ target }: { target: BUI.Button }) => {\n    if (!categoriesDropdownB) return;\n    const categories = categoriesDropdownB.value;\n    if (categories.length === 0) return;\n    target.loading = true;\n    await hideByCategory(categories);\n    target.loading = false;\n  };\n\n  const onResetVisibility = async ({ target }: { target: BUI.Button }) => {\n    target.loading = true;\n    await resetVisibility();\n    target.loading = false;\n  };\n\n  return BUI.html`\n    <bim-panel active label="Hider Tutorial" class="options-menu">\n      <bim-panel-section style="width: 14rem" label="General">\n        <bim-button label="Reset Visibility" @click=${onResetVisibility}></bim-button>\n      </bim-panel-section>\n      <bim-panel-section label="Isolation">\n        ${categoriesDropdownA}\n        <bim-button label="Isolate Category" @click=${onIsolateCategory}></bim-button>\n      </bim-panel-section>\n      <bim-panel-section label="Hiding">\n        ${categoriesDropdownB}\n        <bim-button label="Hide Category" @click=${onHideCategory}></bim-button>\n      </bim-panel-section>\n    </bim-panel>\n  `;\n});\n\ndocument.body.append(panel);\n'})}),"\n",(0,o.jsx)(n.p,{children:"And we will make some logic that adds a button to the screen when the user is visiting our app from their phone, allowing to show or hide the menu. Otherwise, the menu would make the app unusable."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'const button = BUI.Component.create<BUI.PanelSection>(() => {\n  return BUI.html`\n      <bim-button class="phone-menu-toggler" icon="solar:settings-bold"\n        @click="${() => {\n          if (panel.classList.contains("options-menu-visible")) {\n            panel.classList.remove("options-menu-visible");\n          } else {\n            panel.classList.add("options-menu-visible");\n          }\n        }}">\n      </bim-button>\n    `;\n});\n\ndocument.body.append(button);\n'})}),"\n",(0,o.jsx)(n.h3,{id:"\ufe0f-measuring-the-performance-optional",children:"\u23f1\ufe0f Measuring the performance (optional)"}),"\n",(0,o.jsxs)(n.p,{children:["We'll use the ",(0,o.jsx)(n.a,{href:"https://github.com/mrdoob/stats.js",children:"Stats.js"})," to measure the performance of our app. We will add it to the top left corner of the viewport. This way, we'll make sure that the memory consumption and the FPS of our app are under control."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'const stats = new Stats();\nstats.showPanel(2);\ndocument.body.append(stats.dom);\nstats.dom.style.left = "0px";\nstats.dom.style.zIndex = "unset";\nworld.renderer.onBeforeUpdate.add(() => stats.begin());\nworld.renderer.onAfterUpdate.add(() => stats.end());\n'})}),"\n",(0,o.jsx)(n.h3,{id:"-wrap-up",children:"\ud83c\udf89 Wrap up"}),"\n",(0,o.jsx)(n.p,{children:"That's it! Now you're able to manage item visibility in BIM models using the Hider component. You learned how to use the Hider component to isolate, hide, and reset visibility of items. Congratulations! Keep going with more tutorials in the documentation."})]})}function m(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>r});var o=t(6540);const i={},s=o.createContext(i);function a(e){const n=o.useContext(s);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),o.createElement(s.Provider,{value:n},e.children)}}}]);