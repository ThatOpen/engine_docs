"use strict";(self.webpackChunkengine_docs=self.webpackChunkengine_docs||[]).push([[6938],{6768:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>p,frontMatter:()=>s,metadata:()=>r,toc:()=>c});var o=t(4848),i=t(8453);const s={},a=void 0,r={id:"Tutorials/Components/Core/IDSSpecifications",title:"IDSSpecifications",description:'window.open("https://thatopen.github.io/engine_components/examples/IDSSpecifications")} >Go Full Screen',source:"@site/docs/Tutorials/Components/Core/IDSSpecifications.mdx",sourceDirName:"Tutorials/Components/Core",slug:"/Tutorials/Components/Core/IDSSpecifications",permalink:"/Tutorials/Components/Core/IDSSpecifications",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Hider",permalink:"/Tutorials/Components/Core/Hider"},next:{title:"IfcLoader",permalink:"/Tutorials/Components/Core/IfcLoader"}},l={},c=[{value:"\ud83e\uddd0 Reviewing Your IFC Files",id:"-reviewing-your-ifc-files",level:2},{value:"\ud83d\udd96 Importing our Libraries",id:"-importing-our-libraries",level:3},{value:"\ud83c\udf0e Setting up a Simple Scene",id:"-setting-up-a-simple-scene",level:3},{value:"\ud83d\udee0\ufe0f Setting Up Fragments",id:"\ufe0f-setting-up-fragments",level:3},{value:"\ud83d\udcc2 Loading Fragments Models",id:"-loading-fragments-models",level:3},{value:"\u2728 Using the IDS Specifications Component",id:"-using-the-ids-specifications-component",level:3},{value:"\ud83d\udc7b Ghost Mode for Easy Inspection (optional)",id:"-ghost-mode-for-easy-inspection-optional",level:3},{value:"\u2728 Testing a Specification",id:"-testing-a-specification",level:3},{value:"\ud83e\udde9 Adding some UI (optional but recommended)",id:"-adding-some-ui-optional-but-recommended",level:3},{value:"\u23f1\ufe0f Measuring the performance (optional)",id:"\ufe0f-measuring-the-performance-optional",level:3},{value:"\ud83c\udf89 Wrap up",id:"-wrap-up",level:3}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",hr:"hr",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{style:{position:"relative"},children:[(0,o.jsx)("iframe",{src:"https://thatopen.github.io/engine_components/examples/IDSSpecifications"}),(0,o.jsx)("button",{class:"full-screen-btn",onClick:()=>window.open("https://thatopen.github.io/engine_components/examples/IDSSpecifications"),children:"Go Full Screen"})]}),"\n",(0,o.jsx)(n.admonition,{title:"Source",type:"info",children:(0,o.jsxs)(n.p,{children:["Copying and pasting? We've got you covered! You can find the full source code of this tutorial ",(0,o.jsx)(n.a,{href:"https://github.com/ThatOpen/engine_components/blob/main/packages/core/src/openbim/IDSSpecifications/example.ts",children:"here"}),"."]})}),"\n",(0,o.jsx)(n.h2,{id:"-reviewing-your-ifc-files",children:"\ud83e\uddd0 Reviewing Your IFC Files"}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.p,{children:"The buildingSMART has been creating nice standards for the AEC just like IFC for BIM models and BCF for communication. The two of them are great, but when it comes to review if an IFC file complies with some requirements there is the perfect standard for it: IDS. In That Open Engine is possibile not only to create IDS files, but also to import and export then; in this tutorial you will learn everything you need to know to get started!"}),"\n",(0,o.jsx)(n.h3,{id:"-importing-our-libraries",children:"\ud83d\udd96 Importing our Libraries"}),"\n",(0,o.jsx)(n.p,{children:"First things first, let's install all necessary dependencies to make this example work:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'import * as THREE from "three";\nimport * as FRAGS from "@thatopen/fragments";\nimport Stats from "stats.js";\nimport * as BUI from "@thatopen/ui";\n// You have to import * as OBC from "@thatopen/components"\nimport * as OBC from "../..";\n'})}),"\n",(0,o.jsx)(n.h3,{id:"-setting-up-a-simple-scene",children:"\ud83c\udf0e Setting up a Simple Scene"}),"\n",(0,o.jsx)(n.p,{children:"To get started, let's set up a basic ThreeJS scene. This will serve as the foundation for our application and allow us to visualize the 3D models effectively:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'const components = new OBC.Components();\n\nconst worlds = components.get(OBC.Worlds);\nconst world = worlds.create<\n  OBC.SimpleScene,\n  OBC.OrthoPerspectiveCamera,\n  OBC.SimpleRenderer\n>();\n\nworld.scene = new OBC.SimpleScene(components);\nworld.scene.setup();\nworld.scene.three.background = null;\n\nconst container = document.getElementById("container")!;\nworld.renderer = new OBC.SimpleRenderer(components, container);\nworld.camera = new OBC.OrthoPerspectiveCamera(components);\nawait world.camera.controls.setLookAt(78, 20, -2.2, 26, -4, 25);\n\ncomponents.init();\n'})}),"\n",(0,o.jsx)(n.h3,{id:"\ufe0f-setting-up-fragments",children:"\ud83d\udee0\ufe0f Setting Up Fragments"}),"\n",(0,o.jsx)(n.p,{children:"Now, let's configure the FragmentsManager. This will allow us to load models effortlessly and start manipulating them with ease:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'const workerUrl =\n  "https://thatopen.github.io/engine_fragment/resources/worker.mjs";\nconst fragments = components.get(OBC.FragmentsManager);\nfragments.init(workerUrl);\n\nworld.camera.controls.addEventListener("rest", () =>\n  fragments.core.update(true),\n);\n\nworld.onCameraChanged.add((camera) => {\n  for (const [, model] of fragments.list) {\n    model.useCamera(camera.three);\n  }\n  fragments.core.update(true);\n});\n\nfragments.list.onItemSet.add(({ value: model }) => {\n  model.useCamera(world.camera.three);\n  world.scene.three.add(model.object);\n  fragments.core.update(true);\n});\n'})}),"\n",(0,o.jsx)(n.h3,{id:"-loading-fragments-models",children:"\ud83d\udcc2 Loading Fragments Models"}),"\n",(0,o.jsx)(n.p,{children:"With the core setup complete, it's time to load a Fragments model into our scene. Fragments are optimized for fast loading and rendering, making them ideal for large-scale 3D models."}),"\n",(0,o.jsx)(n.admonition,{title:"Where can I find Fragment files?",type:"info",children:(0,o.jsx)(n.p,{children:"You can use the sample Fragment files available in our repository for testing. If you have an IFC model you'd like to convert to Fragments, check out the IfcImporter tutorial for detailed instructions."})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'const fragPaths = ["https://thatopen.github.io/engine_components/resources/frags/school_arq.frag"];\nawait Promise.all(\n  fragPaths.map(async (path) => {\n    const modelId = path.split("/").pop()?.split(".").shift();\n    if (!modelId) return null;\n    const file = await fetch(path);\n    const buffer = await file.arrayBuffer();\n    return fragments.core.load(buffer, { modelId });\n  }),\n);\n'})}),"\n",(0,o.jsx)(n.h3,{id:"-using-the-ids-specifications-component",children:"\u2728 Using the IDS Specifications Component"}),"\n",(0,o.jsx)(n.p,{children:"Leveraging this component in That Open Engine is straightforward. The process revolves around creating specifications based on facets from the IDS schema. Let's begin by obtaining the component instance:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"const ids = components.get(OBC.IDSSpecifications);\n"})}),"\n",(0,o.jsx)(n.p,{children:"Next, let's create a new specification. In this example, the specification will require that all doors must have the FireRating property defined."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'const spec = ids.create("Sample", ["IFC4"]);\nspec.description =\n  "All doors must have FireRating specified in Pset_DoorCommon";\n'})}),"\n",(0,o.jsxs)(n.p,{children:['IDS schema uses "facets" to define conditions for elements. Facets identify elements (applicability) and specify requirements. Common types include entity, attribute, property, material, classification, and partOf. Learn more in the ',(0,o.jsx)(n.a,{href:"https://github.com/buildingSMART/IDS",children:"IDS schema GitHub repository"}),". In this example, we use two facets: one to match IfcDoor items (entity facet for applicability) and another to verify the FireRating property (property facet for requirements)."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'const entity = new OBC.IDSEntity(components, {\n  type: "simple",\n  parameter: "IFCDOOR",\n});\n\nconst property = new OBC.IDSProperty(\n  components,\n  {\n    type: "simple",\n    parameter: "Pset_DoorCommon",\n  },\n  { type: "simple", parameter: "FireRating" },\n);\n'})}),"\n",(0,o.jsx)(n.p,{children:"Next, simply provide the facets to the specification:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"spec.applicability.add(entity);\nspec.requirements.add(property);\n"})}),"\n",(0,o.jsx)(n.h3,{id:"-ghost-mode-for-easy-inspection-optional",children:"\ud83d\udc7b Ghost Mode for Easy Inspection (optional)"}),"\n",(0,o.jsx)(n.p,{children:"For demonstration purposes, let's create functions that make it easier to review the test results:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'const originalColors = new Map<\n  FRAGS.BIMMaterial,\n  { color: number; transparent: boolean; opacity: number }\n>();\n\nconst setModelTransparent = (components: OBC.Components) => {\n  const fragments = components.get(OBC.FragmentsManager);\n\n  const materials = [...fragments.core.models.materials.list.values()];\n  for (const material of materials) {\n    if (material.userData.customId) continue;\n    // save colors\n    let color: number | undefined;\n    if ("color" in material) {\n      color = material.color.getHex();\n    } else {\n      color = material.lodColor.getHex();\n    }\n\n    originalColors.set(material, {\n      color,\n      transparent: material.transparent,\n      opacity: material.opacity,\n    });\n\n    // set color\n    material.transparent = true;\n    material.opacity = 0.05;\n    material.needsUpdate = true;\n    if ("color" in material) {\n      material.color.setColorName("white");\n    } else {\n      material.lodColor.setColorName("white");\n    }\n  }\n};\n\nconst restoreModelMaterials = () => {\n  for (const [material, data] of originalColors) {\n    const { color, transparent, opacity } = data;\n    material.transparent = transparent;\n    material.opacity = opacity;\n    if ("color" in material) {\n      material.color.setHex(color);\n    } else {\n      material.lodColor.setHex(color);\n    }\n    material.needsUpdate = true;\n  }\n  originalColors.clear();\n};\n\nconst toggleGhost = () => {\n  if (originalColors.size) {\n    restoreModelMaterials();\n  } else {\n    setModelTransparent(components);\n  }\n};\n'})}),"\n",(0,o.jsx)(n.h3,{id:"-testing-a-specification",children:"\u2728 Testing a Specification"}),"\n",(0,o.jsx)(n.p,{children:"Testing a specification is straightforward. Use the class method to test it and convert the result into a ModelIdMap for easy integration with other engine components. Below is a function that tests the specification and highlights passing and failing elements in green and red, respectively."}),"\n",(0,o.jsx)(n.admonition,{title:"Colorizing",type:"warning",children:(0,o.jsx)(n.p,{children:"The colorizing method below is for demonstration purposes only. For real-world applications, use the Highlighter component. Refer to its tutorial for detailed usage."})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'const testSpec = async () => {\n  const result = await spec.test([/arq/]);\n  const { fail, pass } = ids.getModelIdMap(result);\n\n  const highlightPromises = [fragments.resetHighlight()];\n\n  highlightPromises.push(\n    fragments.highlight(\n      {\n        customId: "green",\n        color: new THREE.Color("green"),\n        renderedFaces: FRAGS.RenderedFaces.ONE,\n        opacity: 1,\n        transparent: false,\n      },\n      pass,\n    ),\n  );\n\n  highlightPromises.push(\n    fragments.highlight(\n      {\n        customId: "red",\n        color: new THREE.Color("red"),\n        renderedFaces: FRAGS.RenderedFaces.ONE,\n        opacity: 1,\n        transparent: false,\n      },\n      fail,\n    ),\n  );\n\n  highlightPromises.push(fragments.core.update(true));\n\n  await Promise.all(highlightPromises);\n  toggleGhost();\n};\n'})}),"\n",(0,o.jsx)(n.h3,{id:"-adding-some-ui-optional-but-recommended",children:"\ud83e\udde9 Adding some UI (optional but recommended)"}),"\n",(0,o.jsxs)(n.p,{children:["We will use the ",(0,o.jsx)(n.code,{children:"@thatopen/ui"})," library to add some simple and cool UI elements to our app. First, we need to call the ",(0,o.jsx)(n.code,{children:"init"})," method of the ",(0,o.jsx)(n.code,{children:"BUI.Manager"})," class to initialize the library:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"BUI.Manager.init();\n"})}),"\n",(0,o.jsx)(n.p,{children:"Now we will add some UI to play around with the actions in this tutorial. For more information about the UI library, you can check the specific documentation for it!"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'const panel = BUI.Component.create<BUI.PanelSection>(() => {\n  const onReviewModel = async ({ target }: { target: BUI.Button }) => {\n    target.loading = true;\n    await testSpec();\n    target.loading = false;\n  };\n\n  return BUI.html`\n    <bim-panel active label="IDS Specifications Tutorial" class="options-menu">\n      <bim-panel-section label="General">\n        <bim-button label="Toogle Ghost" @click=${toggleGhost}></bim-button>\n      </bim-panel-section>\n      <bim-panel-section label="Specification">\n        <bim-button label="Review Model" @click=${onReviewModel}></bim-button>\n      </bim-panel-section>\n    </bim-panel>\n  `;\n});\n\ndocument.body.append(panel);\n'})}),"\n",(0,o.jsx)(n.p,{children:"And we will make some logic that adds a button to the screen when the user is visiting our app from their phone, allowing to show or hide the menu. Otherwise, the menu would make the app unusable."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'const button = BUI.Component.create<BUI.PanelSection>(() => {\n  return BUI.html`\n      <bim-button class="phone-menu-toggler" icon="solar:settings-bold"\n        @click="${() => {\n          if (panel.classList.contains("options-menu-visible")) {\n            panel.classList.remove("options-menu-visible");\n          } else {\n            panel.classList.add("options-menu-visible");\n          }\n        }}">\n      </bim-button>\n    `;\n});\n\ndocument.body.append(button);\n'})}),"\n",(0,o.jsx)(n.h3,{id:"\ufe0f-measuring-the-performance-optional",children:"\u23f1\ufe0f Measuring the performance (optional)"}),"\n",(0,o.jsxs)(n.p,{children:["We'll use the ",(0,o.jsx)(n.a,{href:"https://github.com/mrdoob/stats.js",children:"Stats.js"})," to measure the performance of our app. We will add it to the top left corner of the viewport. This way, we'll make sure that the memory consumption and the FPS of our app are under control."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'const stats = new Stats();\nstats.showPanel(2);\ndocument.body.append(stats.dom);\nstats.dom.style.left = "0px";\nstats.dom.style.zIndex = "unset";\nworld.renderer.onBeforeUpdate.add(() => stats.begin());\nworld.renderer.onAfterUpdate.add(() => stats.end());\n'})}),"\n",(0,o.jsx)(n.h3,{id:"-wrap-up",children:"\ud83c\udf89 Wrap up"}),"\n",(0,o.jsx)(n.p,{children:"That's it! Now you're able to create IDS specifications, test them, and visualize the results in a 3D scene. Congratulations! Keep exploring more tutorials in the documentation to enhance your skills further."})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>r});var o=t(6540);const i={},s=o.createContext(i);function a(e){const n=o.useContext(s);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),o.createElement(s.Provider,{value:n},e.children)}}}]);