"use strict";(self.webpackChunkengine_docs=self.webpackChunkengine_docs||[]).push([[2496],{9801:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>p,frontMatter:()=>s,metadata:()=>r,toc:()=>l});var o=t(4848),i=t(8453);const s={},a=void 0,r={id:"Tutorials/Components/Core/BCFTopics",title:"BCFTopics",description:'window.open("https://thatopen.github.io/engine_components/examples/BCFTopics")} >Go Full Screen',source:"@site/docs/Tutorials/Components/Core/BCFTopics.mdx",sourceDirName:"Tutorials/Components/Core",slug:"/Tutorials/Components/Core/BCFTopics",permalink:"/Tutorials/Components/Core/BCFTopics",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Components",permalink:"/Tutorials/Components/"},next:{title:"BoundingBoxer",permalink:"/Tutorials/Components/Core/BoundingBoxer"}},c={},l=[{value:"\ud83d\udc4c Communicating The Right Way",id:"-communicating-the-right-way",level:2},{value:"\ud83d\udd96 Importing our Libraries",id:"-importing-our-libraries",level:3},{value:"\ud83c\udf0e Setting up a Simple Scene",id:"-setting-up-a-simple-scene",level:3},{value:"\ud83d\udee0\ufe0f Setting Up Fragments",id:"\ufe0f-setting-up-fragments",level:3},{value:"\ud83d\udcc2 Loading Fragments Models",id:"-loading-fragments-models",level:3},{value:"\u2728 Using The BCFTopics Component",id:"-using-the-bcftopics-component",level:3},{value:"\ud83d\udce1 Creating Topics",id:"-creating-topics",level:3},{value:"\ud83d\udd04 Editing Topics",id:"-editing-topics",level:3},{value:"\u23ec Exporting BCF Files",id:"-exporting-bcf-files",level:3},{value:"\u23eb Importing BCF Files",id:"-importing-bcf-files",level:3},{value:"\ud83e\udde9 Adding some UI (optional but recommended)",id:"-adding-some-ui-optional-but-recommended",level:3},{value:"\u23f1\ufe0f Measuring the performance (optional)",id:"\ufe0f-measuring-the-performance-optional",level:3},{value:"\ud83c\udf89 Wrap up",id:"-wrap-up",level:3}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",hr:"hr",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{style:{position:"relative"},children:[(0,o.jsx)("iframe",{src:"https://thatopen.github.io/engine_components/examples/BCFTopics"}),(0,o.jsx)("button",{class:"full-screen-btn",onClick:()=>window.open("https://thatopen.github.io/engine_components/examples/BCFTopics"),children:"Go Full Screen"})]}),"\n",(0,o.jsx)(n.admonition,{title:"Source",type:"info",children:(0,o.jsxs)(n.p,{children:["Copying and pasting? We've got you covered! You can find the full source code of this tutorial ",(0,o.jsx)(n.a,{href:"https://github.com/ThatOpen/engine_components/blob/main/packages/core/src/openbim/BCFTopics/example.ts",children:"here"}),"."]})}),"\n",(0,o.jsx)(n.h2,{id:"-communicating-the-right-way",children:"\ud83d\udc4c Communicating The Right Way"}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.p,{children:"Effective communication is essential for all projects, whether in construction or other industries. It is crucial to have a reliable method for project members to communicate and track discussions. In construction projects, BuildingSMART introduced the BIM Collaboration Format (BCF) to standardize communication about ongoing topics among stakeholders. That Open Engine includes integration with BCF, enabling you to read, create, and update any BCF file seamlessly. Let's explore how it works!"}),"\n",(0,o.jsx)(n.h3,{id:"-importing-our-libraries",children:"\ud83d\udd96 Importing our Libraries"}),"\n",(0,o.jsx)(n.p,{children:"First things first, let's install all necessary dependencies to make this example work:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'import Stats from "stats.js";\nimport * as BUI from "@thatopen/ui";\n// You have to import * as OBC from "@thatopen/components"\nimport * as OBC from "../..";\n'})}),"\n",(0,o.jsx)(n.h3,{id:"-setting-up-a-simple-scene",children:"\ud83c\udf0e Setting up a Simple Scene"}),"\n",(0,o.jsx)(n.p,{children:"To get started, let's set up a basic ThreeJS scene. This will serve as the foundation for our application and allow us to visualize the 3D models effectively:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'const components = new OBC.Components();\n\nconst worlds = components.get(OBC.Worlds);\nconst world = worlds.create<\n  OBC.SimpleScene,\n  OBC.OrthoPerspectiveCamera,\n  OBC.SimpleRenderer\n>();\n\nworld.scene = new OBC.SimpleScene(components);\nworld.scene.setup();\nworld.scene.three.background = null;\n\nconst container = document.getElementById("container")!;\nworld.renderer = new OBC.SimpleRenderer(components, container);\nworld.camera = new OBC.OrthoPerspectiveCamera(components);\nawait world.camera.controls.setLookAt(68, 23, -8.5, 21.5, -5.5, 23);\n\ncomponents.init();\n'})}),"\n",(0,o.jsx)(n.h3,{id:"\ufe0f-setting-up-fragments",children:"\ud83d\udee0\ufe0f Setting Up Fragments"}),"\n",(0,o.jsx)(n.p,{children:"Now, let's configure the FragmentsManager. This will allow us to load models effortlessly and start manipulating them with ease:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'const workerUrl =\n  "https://thatopen.github.io/engine_fragment/resources/worker.mjs";\nconst fragments = components.get(OBC.FragmentsManager);\nfragments.init(workerUrl);\n\nworld.camera.controls.addEventListener("rest", () =>\n  fragments.core.update(true),\n);\n\nworld.onCameraChanged.add((camera) => {\n  for (const [, model] of fragments.list) {\n    model.useCamera(camera.three);\n  }\n  fragments.core.update(true);\n});\n\nfragments.list.onItemSet.add(({ value: model }) => {\n  model.useCamera(world.camera.three);\n  world.scene.three.add(model.object);\n  fragments.core.update(true);\n});\n'})}),"\n",(0,o.jsx)(n.h3,{id:"-loading-fragments-models",children:"\ud83d\udcc2 Loading Fragments Models"}),"\n",(0,o.jsx)(n.p,{children:"With the core setup complete, it's time to load a Fragments model into our scene. Fragments are optimized for fast loading and rendering, making them ideal for large-scale 3D models."}),"\n",(0,o.jsx)(n.admonition,{title:"Where can I find Fragment files?",type:"info",children:(0,o.jsx)(n.p,{children:"You can use the sample Fragment files available in our repository for testing. If you have an IFC model you'd like to convert to Fragments, check out the IfcImporter tutorial for detailed instructions."})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'const fragPaths = ["https://thatopen.github.io/engine_components/resources/frags/school_arq.frag"];\nawait Promise.all(\n  fragPaths.map(async (path) => {\n    const modelId = path.split("/").pop()?.split(".").shift();\n    if (!modelId) return null;\n    const file = await fetch(path);\n    const buffer = await file.arrayBuffer();\n    return fragments.core.load(buffer, { modelId });\n  }),\n);\n'})}),"\n",(0,o.jsx)(n.h3,{id:"-using-the-bcftopics-component",children:"\u2728 Using The BCFTopics Component"}),"\n",(0,o.jsx)(n.p,{children:"Let's enable your app to handle BCF files effortlessly. BCF files are compressed archives (zip) containing folders, each representing a topic. Topics are communications within a project, such as design issues, progress updates, or information requests. They include metadata like title, description, status, assignee, stage, comments, and some more."}),"\n",(0,o.jsx)(n.admonition,{title:"BCF Basics",type:"info",children:(0,o.jsx)(n.p,{children:"BCF files also contain viewpoints, which store camera positions, targets, and references to IFC model entities via GUIDs. Viewpoints are linked to topics, but a topic can exist without a viewpoint, while a viewpoint must belong to a topic."})}),"\n",(0,o.jsx)(n.p,{children:"In That Open Engine, you can create topics and viewpoints independently, then link them as needed. This tutorial focuses on topics. To get started, create an instance of the topics component:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'const bcfTopics = components.get(OBC.BCFTopics);\nbcfTopics.setup({\n  author: "signed.user@mail.com", // This will be the mail used in all topics created\n  types: new Set([...bcfTopics.config.types, "Information", "Coordination"]),\n  statuses: new Set(["Active", "In Progress", "Done", "In Review", "Closed"]),\n  users: new Set(["juan.hoyos4@gmail.com"]),\n  version: "3",\n});\n'})}),"\n",(0,o.jsx)(n.p,{children:"The component supports callbacks for topic creation, deletion, and updates. Here's an example of creating a new viewpoint whenever a topic is created:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"const viewpoints = components.get(OBC.Viewpoints);\nbcfTopics.list.onItemSet.add(async ({ value: topic }) => {\n  const viewpoint = viewpoints.create();\n  viewpoint.world = world;\n\n  // Topics include references to the viewpoints.\n  // The reference is made using the viewpoint GUID instead of the whole viewpoint object.\n  // This prevents having possible memory leaks.\n  topic.viewpoints.add(viewpoint.guid);\n\n  // Comments can be optionally related to viewpoints.\n  // In this case, each time a comment is added the default viewpoint is used on it.\n  topic.comments.onItemSet.add(({ value: comment }) => {\n    comment.viewpoint = viewpoint.guid;\n  });\n});\n"})}),"\n",(0,o.jsx)(n.admonition,{type:"info",children:(0,o.jsx)(n.p,{children:"For more details on viewpoints, check the dedicated tutorial."})}),"\n",(0,o.jsx)(n.h3,{id:"-creating-topics",children:"\ud83d\udce1 Creating Topics"}),"\n",(0,o.jsx)(n.p,{children:"With the component set up, let's create a topic. While you can instantiate a Topic directly, it's best to use the BCFTopics component. This ensures the topic is tracked and accessible later. Here's how to create a topic:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'const topic = bcfTopics.create({\n  title: "Missing information",\n  description: "It seems these elements are badly defined.",\n  dueDate: new Date("08-01-2020"),\n  type: "Clash",\n  priority: "Major",\n  stage: "Design",\n  labels: new Set(["Architecture", "Cost Estimation"]),\n  assignedTo: "juan.hoyos@thatopen.com",\n});\n'})}),"\n",(0,o.jsx)(n.p,{children:"By BCF standards, topics must include a guid, type, status, title, creationDate, and creationAuthor. However, when creating a topic, all parameters are optional because default values are preconfigured. You can customize these defaults, including additional properties, to better suit your app. Here's how:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'// Only topics creater after this will be affected.\n// creationDate is excluded as is taken from the current date.\n// creationAuthor is excluded as is taken from BCFTopics.config.author\n// guid is excluded as its set internally by the class.\nOBC.Topic.default = {\n  title: "Custom Default Title",\n  type: "Custom Default Topic Type",\n  status: "Custom Default Topic Status",\n  priority: "Custom Default Priority", // this is optional\n};\n'})}),"\n",(0,o.jsx)(n.p,{children:"One of the most common things in topics is to create comments. You can do it very easily like this:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'const firstComment = topic.createComment(\n  "What if we talk about this next meeting?",\n);\n\nconst secondComment = topic.createComment("Hi there! I agree.");\n'})}),"\n",(0,o.jsx)(n.admonition,{type:"tip",children:(0,o.jsx)(n.p,{children:"Comments automatically set the author and creationDate based on BCFTopics.config.author and the current date."})}),"\n",(0,o.jsx)(n.h3,{id:"-editing-topics",children:"\ud83d\udd04 Editing Topics"}),"\n",(0,o.jsxs)(n.p,{children:["Topics are editable like regular classes. Direct property updates won't trigger events, but using the ",(0,o.jsx)(n.code,{children:"set"})," method will. Here's an example of listening for topic updates:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'bcfTopics.list.onItemUpdated.add(({ value: topic }) => {\n  console.log(`Topic ${topic.title} was updated!`);\n});\n\n// This updates the information, but doesn\'t trigger any update.\ntopic.title = "Updated Title";\n\n// This updates the information, but also triggers updates listened by the UI in `@thatopen/ui`\ntopic.set({ title: "New Title" });\n\ntopic.comments.onItemUpdated.add(({ value: comment }) => {\n  console.log("The following comment has been updated:", comment);\n});\n\n// When you update a comment, it triggers an event you can listen in topic.comments.onItemUpdated\nfirstComment.comment =\n  "What if we talk about this next meeting with all partners?";\n\nsecondComment.comment = "Will tell you tomorrow when is more convenient!";\n'})}),"\n",(0,o.jsx)(n.h3,{id:"-exporting-bcf-files",children:"\u23ec Exporting BCF Files"}),"\n",(0,o.jsx)(n.p,{children:"A robust BCF system is incomplete without the ability to export files for use in other BIM applications. Here's a simple function to export BCF files:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'const exportBCF = async () => {\n  // You can indicate which topics to export. All are exported by default\n  const bcf = await bcfTopics.export();\n  // You must set the extension by yourself. The export just gives the binary data.\n  const bcfFile = new File([bcf], "topics.bcf");\n  const a = document.createElement("a");\n  a.href = URL.createObjectURL(bcfFile);\n  a.download = bcfFile.name;\n  a.click();\n  URL.revokeObjectURL(a.href);\n};\n'})}),"\n",(0,o.jsx)(n.h3,{id:"-importing-bcf-files",children:"\u23eb Importing BCF Files"}),"\n",(0,o.jsx)(n.p,{children:"The BCFTopics component allows importing valid BCF files (versions 2.1/3.0). Here's a simple implementation:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'const loadBCF = () => {\n  const input = document.createElement("input");\n  input.multiple = false;\n  input.accept = ".bcf";\n  input.type = "file";\n\n  input.addEventListener("change", async () => {\n    const file = input.files?.[0];\n    if (!file) return;\n    const buffer = await file.arrayBuffer();\n    const { topics, viewpoints } = await bcfTopics.load(new Uint8Array(buffer));\n    console.log(topics, viewpoints);\n  });\n\n  input.click();\n};\n'})}),"\n",(0,o.jsx)(n.admonition,{type:"tip",children:(0,o.jsx)(n.p,{children:"Uploading a BCF file creates corresponding topics and their associated viewpoints. For more details on viewpoints, refer to the dedicated tutorial."})}),"\n",(0,o.jsx)(n.h3,{id:"-adding-some-ui-optional-but-recommended",children:"\ud83e\udde9 Adding some UI (optional but recommended)"}),"\n",(0,o.jsxs)(n.p,{children:["We will use the ",(0,o.jsx)(n.code,{children:"@thatopen/ui"})," library to add some simple and cool UI elements to our app. First, we need to call the ",(0,o.jsx)(n.code,{children:"init"})," method of the ",(0,o.jsx)(n.code,{children:"BUI.Manager"})," class to initialize the library:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"BUI.Manager.init();\n"})}),"\n",(0,o.jsx)(n.p,{children:"Now we will add some UI to play around with the actions in this tutorial. For more information about the UI library, you can check the specific documentation for it!"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'const panel = BUI.Component.create<BUI.PanelSection>(() => {\n  return BUI.html`\n    <bim-panel active label="BCFTopics Tutorial" class="options-menu">\n      <bim-panel-section label="Info">\n        <bim-label style="width: 14rem; white-space: normal;">\ud83d\udca1 To fully experience this tutorial, open your browser console!</bim-label> \n      </bim-panel-section>\n      <bim-panel-section label="Controls">\n        <bim-button @click=${exportBCF} label="Export BCF"></bim-button> \n        <bim-button @click=${loadBCF} label="Load BCF"></bim-button>\n      </bim-panel-section>\n    </bim-panel>\n  `;\n});\n\ndocument.body.append(panel);\n'})}),"\n",(0,o.jsx)(n.p,{children:"And we will make some logic that adds a button to the screen when the user is visiting our app from their phone, allowing to show or hide the menu. Otherwise, the menu would make the app unusable."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'const button = BUI.Component.create<BUI.PanelSection>(() => {\n  return BUI.html`\n      <bim-button class="phone-menu-toggler" icon="solar:settings-bold"\n        @click="${() => {\n          if (panel.classList.contains("options-menu-visible")) {\n            panel.classList.remove("options-menu-visible");\n          } else {\n            panel.classList.add("options-menu-visible");\n          }\n        }}">\n      </bim-button>\n    `;\n});\n\ndocument.body.append(button);\n'})}),"\n",(0,o.jsx)(n.h3,{id:"\ufe0f-measuring-the-performance-optional",children:"\u23f1\ufe0f Measuring the performance (optional)"}),"\n",(0,o.jsxs)(n.p,{children:["We'll use the ",(0,o.jsx)(n.a,{href:"https://github.com/mrdoob/stats.js",children:"Stats.js"})," to measure the performance of our app. We will add it to the top left corner of the viewport. This way, we'll make sure that the memory consumption and the FPS of our app are under control."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'const stats = new Stats();\nstats.showPanel(2);\ndocument.body.append(stats.dom);\nstats.dom.style.left = "0px";\nstats.dom.style.zIndex = "unset";\nworld.renderer.onBeforeUpdate.add(() => stats.begin());\nworld.renderer.onAfterUpdate.add(() => stats.end());\n'})}),"\n",(0,o.jsx)(n.h3,{id:"-wrap-up",children:"\ud83c\udf89 Wrap up"}),"\n",(0,o.jsx)(n.p,{children:"That's it! Now you're able to create, edit, import, and export BCF files, as well as manage topics effectively. Congratulations! Keep going with more tutorials in the documentation."})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>r});var o=t(6540);const i={},s=o.createContext(i);function a(e){const n=o.useContext(s);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),o.createElement(s.Provider,{value:n},e.children)}}}]);