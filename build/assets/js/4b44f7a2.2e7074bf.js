"use strict";(self.webpackChunkengine_docs=self.webpackChunkengine_docs||[]).push([[8081],{2548:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>d,frontMatter:()=>a,metadata:()=>i,toc:()=>c});var o=t(4848),s=t(8453);const a={},r=void 0,i={id:"Tutorials/Components/Front/VolumeMeasurement",title:"VolumeMeasurement",description:'window.open("https://thatopen.github.io/engine_components/examples/VolumeMeasurement")} >Go Full Screen',source:"@site/docs/Tutorials/Components/Front/VolumeMeasurement.mdx",sourceDirName:"Tutorials/Components/Front",slug:"/Tutorials/Components/Front/VolumeMeasurement",permalink:"/Tutorials/Components/Front/VolumeMeasurement",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"PostproductionRenderer",permalink:"/Tutorials/Components/Front/PostproductionRenderer"},next:{title:"Fragments",permalink:"/Tutorials/Fragments/"}},l={},c=[{value:"\ud83d\udcd0 Measuring Volumes",id:"-measuring-volumes",level:2},{value:"\ud83d\udd96 Importing our Libraries",id:"-importing-our-libraries",level:3},{value:"\ud83c\udf0e Setting up a Simple Scene",id:"-setting-up-a-simple-scene",level:3},{value:"\ud83d\udee0\ufe0f Setting Up Fragments",id:"\ufe0f-setting-up-fragments",level:3},{value:"\ud83d\udcc2 Loading Fragments Models",id:"-loading-fragments-models",level:3},{value:"\u2728 Using The Length Measurement Component",id:"-using-the-length-measurement-component",level:3},{value:"\ud83d\udcc4 The Measurements List",id:"-the-measurements-list",level:3},{value:"\ud83d\udd17 Measurement Events",id:"-measurement-events",level:3},{value:"\ud83e\udde9 Adding some UI (optional but recommended)",id:"-adding-some-ui-optional-but-recommended",level:3},{value:"\u23f1\ufe0f Measuring the performance (optional)",id:"\ufe0f-measuring-the-performance-optional",level:3},{value:"\ud83c\udf89 Wrap up",id:"-wrap-up",level:3}];function m(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",hr:"hr",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{style:{position:"relative"},children:[(0,o.jsx)("iframe",{src:"https://thatopen.github.io/engine_components/examples/VolumeMeasurement"}),(0,o.jsx)("button",{class:"full-screen-btn",onClick:()=>window.open("https://thatopen.github.io/engine_components/examples/VolumeMeasurement"),children:"Go Full Screen"})]}),"\n",(0,o.jsx)(n.admonition,{title:"Source",type:"info",children:(0,o.jsxs)(n.p,{children:["Copying and pasting? We've got you covered! You can find the full source code of this tutorial ",(0,o.jsx)(n.a,{href:"https://github.com/ThatOpen/engine_components/blob/main/packages/front/src/measurement/VolumeMeasurement/example.ts",children:"here"}),"."]})}),"\n",(0,o.jsx)(n.h2,{id:"-measuring-volumes",children:"\ud83d\udcd0 Measuring Volumes"}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.p,{children:"Accurate volume measurement is a critical feature in Building Information Modeling (BIM) applications. Whether you're estimating material quantities, analyzing spatial properties, or collaborating on designs, providing users with intuitive tools to measure volumes in 3D space is essential. In this tutorial, you will learn how to integrate a volume measuring tool in your BIM app; let's dive in!"}),"\n",(0,o.jsx)(n.h3,{id:"-importing-our-libraries",children:"\ud83d\udd96 Importing our Libraries"}),"\n",(0,o.jsx)(n.p,{children:"First things first, let's install all necessary dependencies to make this example work:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'import * as THREE from "three";\nimport Stats from "stats.js";\nimport * as OBC from "@thatopen/components";\nimport * as BUI from "@thatopen/ui";\n// You have to import * as OBF from "@thatopen/components-front"\nimport * as OBF from "../..";\n'})}),"\n",(0,o.jsx)(n.h3,{id:"-setting-up-a-simple-scene",children:"\ud83c\udf0e Setting up a Simple Scene"}),"\n",(0,o.jsx)(n.p,{children:"To get started, let's set up a basic ThreeJS scene. This will serve as the foundation for our application and allow us to visualize the 3D models effectively:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'const components = new OBC.Components();\n\nconst worlds = components.get(OBC.Worlds);\nconst world = worlds.create<\n  OBC.SimpleScene,\n  OBC.OrthoPerspectiveCamera,\n  OBF.PostproductionRenderer\n>();\n\nworld.scene = new OBC.SimpleScene(components);\nworld.scene.setup();\nworld.scene.three.background = null;\n\nconst container = document.getElementById("container")!;\nworld.renderer = new OBF.PostproductionRenderer(components, container);\nworld.camera = new OBC.OrthoPerspectiveCamera(components);\nawait world.camera.controls.setLookAt(68, 23, -8.5, 21.5, -5.5, 23);\n\ncomponents.init();\n'})}),"\n",(0,o.jsx)(n.h3,{id:"\ufe0f-setting-up-fragments",children:"\ud83d\udee0\ufe0f Setting Up Fragments"}),"\n",(0,o.jsx)(n.p,{children:"Now, let's configure the FragmentsManager. This will allow us to load models effortlessly and start manipulating them with ease:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'const workerUrl =\n  "https://thatopen.github.io/engine_fragment/resources/worker.mjs";\nconst fragments = components.get(OBC.FragmentsManager);\nfragments.init(workerUrl);\n\nworld.camera.controls.addEventListener("rest", () =>\n  fragments.core.update(true),\n);\n\nworld.onCameraChanged.add((camera) => {\n  for (const [, model] of fragments.list) {\n    model.useCamera(camera.three);\n  }\n  fragments.core.update(true);\n});\n\nfragments.list.onItemSet.add(({ value: model }) => {\n  model.useCamera(world.camera.three);\n  world.scene.three.add(model.object);\n  fragments.core.update(true);\n});\n'})}),"\n",(0,o.jsx)(n.h3,{id:"-loading-fragments-models",children:"\ud83d\udcc2 Loading Fragments Models"}),"\n",(0,o.jsx)(n.p,{children:"With the core setup complete, it's time to load a Fragments model into our scene. Fragments are optimized for fast loading and rendering, making them ideal for large-scale 3D models."}),"\n",(0,o.jsx)(n.admonition,{title:"Where can I find Fragment files?",type:"info",children:(0,o.jsx)(n.p,{children:"You can use the sample Fragment files available in our repository for testing. If you have an IFC model you'd like to convert to Fragments, check out the IfcImporter tutorial for detailed instructions."})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'const fragPaths = ["https://thatopen.github.io/engine_components/resources/frags/school_arq.frag"];\nawait Promise.all(\n  fragPaths.map(async (path) => {\n    const modelId = path.split("/").pop()?.split(".").shift();\n    if (!modelId) return null;\n    const file = await fetch(path);\n    const buffer = await file.arrayBuffer();\n    return fragments.core.load(buffer, { modelId });\n  }),\n);\n'})}),"\n",(0,o.jsx)(n.h3,{id:"-using-the-length-measurement-component",children:"\u2728 Using The Length Measurement Component"}),"\n",(0,o.jsx)(n.p,{children:"Now, let's go with the tutorial core: measuring lengths. First, let's get an instance of the component:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'const measurer = components.get(OBF.VolumeMeasurement);\n// Provide a world to create dimensions inside\nmeasurer.world = world;\nmeasurer.color = new THREE.Color("#494cb6");\n// As a best practice, always set the enabled state after the initial config\nmeasurer.enabled = true;\n'})}),"\n",(0,o.jsx)(n.p,{children:"You can create dimensions both programatically or by user interaction. The most common way is by user interaction, so let's configure an event listener to create them when the user double clicks on the viewer container:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'container.ondblclick = () => measurer.create();\nwindow.addEventListener("keydown", (e) => {\n  if (!(e.code === "Enter" || e.code === "NumpadEnter")) return;\n  measurer.endCreation();\n});\n'})}),"\n",(0,o.jsx)(n.h3,{id:"-the-measurements-list",children:"\ud83d\udcc4 The Measurements List"}),"\n",(0,o.jsx)(n.p,{children:"Whenever you create a dimension using the component, it is automatically added to a list that keeps track of all dimensions. This centralized list allows you to perform various operations, such as deleting dimensions, calculating their centers, reporting all lengths, and more. To illustrate this functionality, let's implement some useful methods:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"const deleteDimensions = () => {\n  measurer.list.clear();\n};\n\nconst getAllValues = async () => {\n  const values: number[] = [];\n  for (const volume of measurer.list) {\n    const value = await volume.getValue();\n    values.push(value);\n  }\n  return values;\n};\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Now, when a dimension gets added to the list a couple of things happen. Among them, is the calculation of a bounding box that can be used to know when the cursor is on top of the graphical display of the measurement. That is used internally by the component to allow delete a dimension that is just beneath the mouse. We'll keep it simple and bind this functionality to the keydown event, specifically it will fire when the user presses the ",(0,o.jsx)(n.code,{children:"Delete"})," or ",(0,o.jsx)(n.code,{children:"Backspace"})," key."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'window.onkeydown = (event) => {\n  if (event.code === "Delete" || event.code === "Backspace") {\n    measurer.delete();\n  }\n};\n'})}),"\n",(0,o.jsx)(n.h3,{id:"-measurement-events",children:"\ud83d\udd17 Measurement Events"}),"\n",(0,o.jsx)(n.p,{children:"You already know anytime you create a dimension the result will get added to the list. When something happens to the list (a dimension has been added or deleted, for example) you can perform side actions by just listening to the corresponding events. Just for fun, let's zoom into the dimension once it has been created:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"measurer.list.onItemAdded.add(async (volume) => {\n  const box = await volume.getBox();\n  const sphere = new THREE.Sphere();\n  box.getBoundingSphere(sphere);\n  world.camera.controls.fitToSphere(sphere, true);\n});\n"})}),"\n",(0,o.jsx)(n.h3,{id:"-adding-some-ui-optional-but-recommended",children:"\ud83e\udde9 Adding some UI (optional but recommended)"}),"\n",(0,o.jsxs)(n.p,{children:["We will use the ",(0,o.jsx)(n.code,{children:"@thatopen/ui"})," library to add some simple and cool UI elements to our app. First, we need to call the ",(0,o.jsx)(n.code,{children:"init"})," method of the ",(0,o.jsx)(n.code,{children:"BUI.Manager"})," class to initialize the library:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"BUI.Manager.init();\n"})}),"\n",(0,o.jsx)(n.p,{children:"Now we will add some UI to play around with the actions in this tutorial. For more information about the UI library, you can check the specific documentation for it!"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'const panel = BUI.Component.create<BUI.PanelSection>(() => {\n  const onLogValues = async ({ target }: { target: BUI.Button }) => {\n    target.loading = true;\n    const data = await getAllValues();\n    console.log(data);\n    target.loading = false;\n  };\n\n  return BUI.html`\n    <bim-panel active label="Length Measurement Tutorial" class="options-menu">\n      <bim-panel-section label="Controls">\n          <bim-label>Create dimension: Double click</bim-label>  \n          <bim-label>Delete dimension: Delete</bim-label>  \n      </bim-panel-section>\n      \n      <bim-panel-section label="Measurer">\n        <bim-checkbox checked label="Enabled" \n          @change="${({ target }: { target: BUI.Checkbox }) => {\n            measurer.enabled = target.value;\n          }}">  \n        </bim-checkbox>       \n        <bim-checkbox checked label="Measurements Visible" \n          @change="${({ target }: { target: BUI.Checkbox }) => {\n            measurer.visible = target.value;\n          }}">  \n        </bim-checkbox>  \n        \n        <bim-color-input \n          label="Color" color=#${measurer.linesMaterial.color.getHexString()}\n          @input="${({ target }: { target: BUI.ColorInput }) => {\n            measurer.color = new THREE.Color(target.color);\n          }}">\n        </bim-color-input>\n        \n        <bim-dropdown \n          label="Measure Mode" required\n          @change="${({ target }: { target: BUI.Dropdown }) => {\n            const [mode] = target.value;\n            measurer.mode = mode;\n          }}"> ${measurer.modes.map(\n            (mode) =>\n              BUI.html`<bim-option label=${mode} value=${mode} ?checked=${mode === measurer.mode}></bim-option>`,\n          )}\n        </bim-dropdown>\n\n        <bim-dropdown\n          label="Units" required\n          @change="${({ target }: { target: BUI.Dropdown }) => {\n            const [units] = target.value;\n            measurer.units = units;\n          }}">\n          ${measurer.unitsList.map(\n            (unit) =>\n              BUI.html`<bim-option label=${unit} value=${unit} ?checked=${unit === measurer.units}></bim-option>`,\n          )}\n        </bim-dropdown>\n\n        <bim-dropdown \n          label="Pricision" required\n          @change="${({ target }: { target: BUI.Dropdown }) => {\n            const [rounding] = target.value;\n            measurer.rounding = rounding;\n          }}">\n          <bim-option label="0" value=0></bim-option>\n          <bim-option label="1" value=1></bim-option>\n          <bim-option label="2" value=2 checked></bim-option>\n          <bim-option label="3" value=3></bim-option>\n          <bim-option label="4" value=4></bim-option>\n          <bim-option label="5" value=5></bim-option>\n        </bim-dropdown>\n\n        <bim-button label="Delete all" @click=${() => deleteDimensions()}></bim-button>\n        \n        <bim-button label="Log Values" @click=${onLogValues}></bim-button>\n      </bim-panel-section>\n    </bim-panel>\n  `;\n});\n\ndocument.body.append(panel);\n'})}),"\n",(0,o.jsx)(n.p,{children:"And we will make some logic that adds a button to the screen when the user is visiting our app from their phone, allowing to show or hide the menu. Otherwise, the menu would make the app unusable."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'const button = BUI.Component.create<BUI.PanelSection>(() => {\n  return BUI.html`\n      <bim-button class="phone-menu-toggler" icon="solar:settings-bold"\n        @click="${() => {\n          if (panel.classList.contains("options-menu-visible")) {\n            panel.classList.remove("options-menu-visible");\n          } else {\n            panel.classList.add("options-menu-visible");\n          }\n        }}">\n      </bim-button>\n    `;\n});\n\ndocument.body.append(button);\n'})}),"\n",(0,o.jsx)(n.h3,{id:"\ufe0f-measuring-the-performance-optional",children:"\u23f1\ufe0f Measuring the performance (optional)"}),"\n",(0,o.jsxs)(n.p,{children:["We'll use the ",(0,o.jsx)(n.a,{href:"https://github.com/mrdoob/stats.js",children:"Stats.js"})," to measure the performance of our app. We will add it to the top left corner of the viewport. This way, we'll make sure that the memory consumption and the FPS of our app are under control."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'const stats = new Stats();\nstats.showPanel(2);\ndocument.body.append(stats.dom);\nstats.dom.style.left = "0px";\nstats.dom.style.zIndex = "unset";\nworld.renderer.onBeforeUpdate.add(() => stats.begin());\nworld.renderer.onAfterUpdate.add(() => stats.end());\n'})}),"\n",(0,o.jsx)(n.h3,{id:"-wrap-up",children:"\ud83c\udf89 Wrap up"}),"\n",(0,o.jsx)(n.p,{children:"That's it! Now you're able to measure lengths in your BIM application using the LengthMeasurement component. Congratulations! Keep going with more tutorials in the documentation."})]})}function d(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(m,{...e})}):m(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>i});var o=t(6540);const s={},a=o.createContext(s);function r(e){const n=o.useContext(a);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),o.createElement(a.Provider,{value:n},e.children)}}}]);