"use strict";(self.webpackChunkengine_docs=self.webpackChunkengine_docs||[]).push([[5740],{1307:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>r,contentTitle:()=>a,default:()=>d,frontMatter:()=>l,metadata:()=>s,toc:()=>c});var i=t(4848),o=t(8453);const l={},a=void 0,s={id:"Tutorials/Components/Core/Clipper",title:"Clipper",description:'window.open("https://thatopen.github.io/engine_components/examples/Clipper")} >Go Full Screen',source:"@site/docs/Tutorials/Components/Core/Clipper.mdx",sourceDirName:"Tutorials/Components/Core",slug:"/Tutorials/Components/Core/Clipper",permalink:"/Tutorials/Components/Core/Clipper",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Classifier",permalink:"/Tutorials/Components/Core/Classifier"},next:{title:"FragmentsManager",permalink:"/Tutorials/Components/Core/FragmentsManager"}},r={},c=[{value:"\u2702\ufe0f Cutting Models",id:"\ufe0f-cutting-models",level:2},{value:"\ud83d\udd96 Importing our Libraries",id:"-importing-our-libraries",level:3},{value:"\ud83c\udf0e Setting up a Simple Scene",id:"-setting-up-a-simple-scene",level:3},{value:"\ud83d\udee0\ufe0f Setting Up Fragments",id:"\ufe0f-setting-up-fragments",level:3},{value:"\ud83d\udcc2 Loading Fragments Models",id:"-loading-fragments-models",level:3},{value:"\u2728 Using The Clipper Component",id:"-using-the-clipper-component",level:3},{value:"\ud83e\uddf9 Deleting Clipping Planes",id:"-deleting-clipping-planes",level:3},{value:"\ud83e\udde9 Adding some UI (optional but recommended)",id:"-adding-some-ui-optional-but-recommended",level:3},{value:"\u23f1\ufe0f Measuring the performance (optional)",id:"\ufe0f-measuring-the-performance-optional",level:3},{value:"\ud83c\udf89 Wrap up",id:"-wrap-up",level:3}];function p(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",hr:"hr",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{style:{position:"relative"},children:[(0,i.jsx)("iframe",{src:"https://thatopen.github.io/engine_components/examples/Clipper"}),(0,i.jsx)("button",{class:"full-screen-btn",onClick:()=>window.open("https://thatopen.github.io/engine_components/examples/Clipper"),children:"Go Full Screen"})]}),"\n",(0,i.jsx)(n.admonition,{title:"Source",type:"info",children:(0,i.jsxs)(n.p,{children:["Copying and pasting? We've got you covered! You can find the full source code of this tutorial ",(0,i.jsx)(n.a,{href:"https://github.com/ThatOpen/engine_components/blob/main/packages/core/src/core/Clipper/example.ts",children:"here"}),"."]})}),"\n",(0,i.jsx)(n.h2,{id:"\ufe0f-cutting-models",children:"\u2702\ufe0f Cutting Models"}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.p,{children:"The Clipping Tool is a powerful feature in 3D modelling that helps you dissect 3D objects. Clipping Tool is useful for inspecting and analyzing objects in detail.\ud83d\udcaa"}),"\n",(0,i.jsx)(n.admonition,{title:"Clipping?",type:"tip",children:(0,i.jsx)(n.p,{children:'Clipping is the process of "cutting" a 3D object by creating a plane. That way, we can have a bird view of the inside of a BIM model.'})}),"\n",(0,i.jsx)(n.h3,{id:"-importing-our-libraries",children:"\ud83d\udd96 Importing our Libraries"}),"\n",(0,i.jsx)(n.p,{children:"First things first, let's install all necessary dependencies to make this example work:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:'import * as THREE from "three";\nimport Stats from "stats.js";\nimport * as BUI from "@thatopen/ui";\n// You have to import * as OBC from "@thatopen/components"\nimport * as OBC from "../..";\n'})}),"\n",(0,i.jsx)(n.h3,{id:"-setting-up-a-simple-scene",children:"\ud83c\udf0e Setting up a Simple Scene"}),"\n",(0,i.jsx)(n.p,{children:"To get started, let's set up a basic ThreeJS scene. This will serve as the foundation for our application and allow us to visualize the 3D models effectively:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:'const components = new OBC.Components();\n\nconst worlds = components.get(OBC.Worlds);\nconst world = worlds.create<\n  OBC.SimpleScene,\n  OBC.OrthoPerspectiveCamera,\n  OBC.SimpleRenderer\n>();\n\nworld.scene = new OBC.SimpleScene(components);\nworld.scene.setup();\nworld.scene.three.background = null;\n\nconst container = document.getElementById("container")!;\nworld.renderer = new OBC.SimpleRenderer(components, container);\nworld.camera = new OBC.OrthoPerspectiveCamera(components);\nawait world.camera.controls.setLookAt(68, 23, -8.5, 21.5, -5.5, 23);\n\ncomponents.init();\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\ufe0f-setting-up-fragments",children:"\ud83d\udee0\ufe0f Setting Up Fragments"}),"\n",(0,i.jsx)(n.p,{children:"Now, let's configure the FragmentsManager. This will allow us to load models effortlessly and start manipulating them with ease:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:'const workerUrl =\n  "https://thatopen.github.io/engine_fragment/resources/worker.mjs";\nconst fragments = components.get(OBC.FragmentsManager);\nfragments.init(workerUrl);\n\nworld.camera.controls.addEventListener("rest", () =>\n  fragments.core.update(true),\n);\n\nworld.onCameraChanged.add((camera) => {\n  for (const [, model] of fragments.list) {\n    model.useCamera(camera.three);\n  }\n  fragments.core.update(true);\n});\n\nfragments.list.onItemSet.add(({ value: model }) => {\n  model.useCamera(world.camera.three);\n  world.scene.three.add(model.object);\n  fragments.core.update(true);\n});\n'})}),"\n",(0,i.jsx)(n.h3,{id:"-loading-fragments-models",children:"\ud83d\udcc2 Loading Fragments Models"}),"\n",(0,i.jsx)(n.p,{children:"With the core setup complete, it's time to load a Fragments model into our scene. Fragments are optimized for fast loading and rendering, making them ideal for large-scale 3D models."}),"\n",(0,i.jsx)(n.admonition,{title:"Where can I find Fragment files?",type:"info",children:(0,i.jsx)(n.p,{children:"You can use the sample Fragment files available in our repository for testing. If you have an IFC model you'd like to convert to Fragments, check out the IfcImporter tutorial for detailed instructions."})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:'const fragPaths = [\n  "https://thatopen.github.io/engine_components/resources/frags/school_arq.frag",\n];\nawait Promise.all(\n  fragPaths.map(async (path) => {\n    const modelId = path.split("/").pop()?.split(".").shift();\n    if (!modelId) return null;\n    const file = await fetch(path);\n    const buffer = await file.arrayBuffer();\n    return fragments.core.load(buffer, { modelId });\n  }),\n);\n'})}),"\n",(0,i.jsx)(n.h3,{id:"-using-the-clipper-component",children:"\u2728 Using The Clipper Component"}),"\n",(0,i.jsxs)(n.p,{children:["Now comes the exciting part! We will add a Simple Clipper to our scene. While you can instantiate it directly, it's recommended to use the ",(0,i.jsx)(n.code,{children:"components.get(OBC.Clipper)"})," method to retrieve it. All components are designed to function as singletons within a components instance, and using this approach ensures proper singleton behavior."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"// Initialize the Raycaster for the world to track mouse position for clipping planes.\nconst casters = components.get(OBC.Raycasters);\ncasters.get(world);\n\nconst clipper = components.get(OBC.Clipper);\nclipper.enabled = true;\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Now, we want a way to create a clipping plane on demand. You can do it with a ",(0,i.jsx)(n.code,{children:"Single Click"})," or ",(0,i.jsx)(n.code,{children:"Double Click"})," of a mouse. For this tutorial, we will use ",(0,i.jsx)(n.code,{children:"Double Click"}),". This will cast a ray from the mouse position to the scene and check if the ray intersects with any of the 3D objects. If it does, it will create a new clipping plane in the point of intersection."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"container.ondblclick = () => {\n  if (clipper.enabled) {\n    clipper.create(world);\n  }\n};\n"})}),"\n",(0,i.jsx)(n.p,{children:"We can also easily toggle the clipping planes' enabled state, allowing them to either cut or not cut the model, depending on the specific requirements of your application."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"const toggleClippings = () => {\n  for (const [, clipping] of clipper.list) {\n    clipping.enabled = !clipping.enabled;\n  }\n};\n"})}),"\n",(0,i.jsx)(n.admonition,{title:"Raycaster Under the Hood \ud83c\udfa9",type:"info",children:(0,i.jsx)(n.p,{children:"The Raycaster is used to detect intersections within the scene. When the clipper detects a face under the mouse click, it places a clipping plane at the point of intersection. \ud83d\ude0e"})}),"\n",(0,i.jsx)(n.h3,{id:"-deleting-clipping-planes",children:"\ud83e\uddf9 Deleting Clipping Planes"}),"\n",(0,i.jsxs)(n.p,{children:["Now that we know how to create multiple clipping planes, it's equally important to understand how to delete them when needed. Clipping planes can be removed using ",(0,i.jsx)(n.code,{children:"clipper.delete(world)"})," (which deletes the first plane detected under the mouse using the Raycaster in the specified world) or ",(0,i.jsx)(n.code,{children:"clipper.delete(world, plane)"})," (which deletes a specific clipping plane)."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:'window.onkeydown = (event) => {\n  if (event.code === "Delete" || event.code === "Backspace") {\n    if (clipper.enabled) clipper.delete(world);\n  }\n};\n'})}),"\n",(0,i.jsx)(n.h3,{id:"-adding-some-ui-optional-but-recommended",children:"\ud83e\udde9 Adding some UI (optional but recommended)"}),"\n",(0,i.jsxs)(n.p,{children:["We will use the ",(0,i.jsx)(n.code,{children:"@thatopen/ui"})," library to add some simple and cool UI elements to our app. First, we need to call the ",(0,i.jsx)(n.code,{children:"init"})," method of the ",(0,i.jsx)(n.code,{children:"BUI.Manager"})," class to initialize the library:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"BUI.Manager.init();\n"})}),"\n",(0,i.jsx)(n.p,{children:"Now we will add some UI to play around with the actions in this tutorial. For more information about the UI library, you can check the specific documentation for it!"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:'const panel = BUI.Component.create<BUI.PanelSection>(() => {\n  return BUI.html`\n    <bim-panel active label="Clipper Tutorial" class="options-menu">\n      <bim-panel-section label="Commands">\n        <bim-label>Double click: Create clipping plane</bim-label>\n        <bim-label>Delete key: Delete clipping plane</bim-label>\n      </bim-panel-section>\n      <bim-panel-section label="Controls">\n        <bim-checkbox label="Component Enabled" checked \n          @change="${({ target }: { target: BUI.Checkbox }) => {\n            clipper.config.enabled = target.value;\n          }}">\n        </bim-checkbox>\n        \n        <bim-checkbox label="Clipper Visible" checked \n          @change="${({ target }: { target: BUI.Checkbox }) => {\n            clipper.config.visible = target.value;\n          }}">\n        </bim-checkbox>\n      \n        <bim-color-input \n          label="Planes Color" color="#202932" \n          @input="${({ target }: { target: BUI.ColorInput }) => {\n            clipper.config.color = new THREE.Color(target.color);\n          }}">\n        </bim-color-input>\n        \n        <bim-number-input \n          slider step="0.01" label="Planes Opacity" value="0.2" min="0.1" max="1"\n          @change="${({ target }: { target: BUI.NumberInput }) => {\n            clipper.config.opacity = target.value;\n          }}">\n        </bim-number-input>\n        \n        <bim-number-input \n          slider step="0.1" label="Planes Size" value="5" min="2" max="10"\n          @change="${({ target }: { target: BUI.NumberInput }) => {\n            clipper.config.size = target.value;\n          }}">\n        </bim-number-input>\n        \n        <bim-button \n          label="Toggle Clippings" \n          @click=${toggleClippings}>  \n        </bim-button>       \n        \n        <bim-button \n          label="Delete All" \n          @click="${() => {\n            clipper.deleteAll();\n          }}">  \n        </bim-button>       \n        \n      </bim-panel-section>\n    </bim-panel>\n  `;\n});\n\ndocument.body.append(panel);\n'})}),"\n",(0,i.jsx)(n.p,{children:"And we will make some logic that adds a button to the screen when the user is visiting our app from their phone, allowing to show or hide the menu. Otherwise, the menu would make the app unusable."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:'const button = BUI.Component.create<BUI.PanelSection>(() => {\n  return BUI.html`\n      <bim-button class="phone-menu-toggler" icon="solar:settings-bold"\n        @click="${() => {\n          if (panel.classList.contains("options-menu-visible")) {\n            panel.classList.remove("options-menu-visible");\n          } else {\n            panel.classList.add("options-menu-visible");\n          }\n        }}">\n      </bim-button>\n    `;\n});\n\ndocument.body.append(button);\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\ufe0f-measuring-the-performance-optional",children:"\u23f1\ufe0f Measuring the performance (optional)"}),"\n",(0,i.jsxs)(n.p,{children:["We'll use the ",(0,i.jsx)(n.a,{href:"https://github.com/mrdoob/stats.js",children:"Stats.js"})," to measure the performance of our app. We will add it to the top left corner of the viewport. This way, we'll make sure that the memory consumption and the FPS of our app are under control."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:'const stats = new Stats();\nstats.showPanel(2);\ndocument.body.append(stats.dom);\nstats.dom.style.left = "0px";\nstats.dom.style.zIndex = "unset";\nworld.renderer.onBeforeUpdate.add(() => stats.begin());\nworld.renderer.onAfterUpdate.add(() => stats.end());\n'})}),"\n",(0,i.jsx)(n.h3,{id:"-wrap-up",children:"\ud83c\udf89 Wrap up"}),"\n",(0,i.jsx)(n.p,{children:"That's it! Now you're able to create and manipulate clipping planes, toggle their visibility, and delete them as needed. Congratulations! Keep exploring more tutorials in the documentation to enhance your skills further."})]})}function d(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(p,{...e})}):p(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>s});var i=t(6540);const o={},l=i.createContext(o);function a(e){const n=i.useContext(l);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),i.createElement(l.Provider,{value:n},e.children)}}}]);