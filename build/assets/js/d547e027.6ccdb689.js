"use strict";(self.webpackChunkengine_docs=self.webpackChunkengine_docs||[]).push([[4743],{7122:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>m,frontMatter:()=>a,metadata:()=>i,toc:()=>c});var o=t(4848),r=t(8453);const a={},s=void 0,i={id:"Tutorials/Fragments/Fragments/IfcImporter/IfcImporter",title:"IfcImporter",description:'window.open("https://thatopen.github.io/engine_fragment/examples/IfcImporter")} >Go Full Screen',source:"@site/docs/Tutorials/Fragments/Fragments/IfcImporter/IfcImporter.mdx",sourceDirName:"Tutorials/Fragments/Fragments/IfcImporter",slug:"/Tutorials/Fragments/Fragments/IfcImporter/",permalink:"/Tutorials/Fragments/Fragments/IfcImporter/",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"VisibilityOperations",permalink:"/Tutorials/Fragments/Fragments/FragmentsModels/VisibilityOperations"},next:{title:"HelloWorldSchema",permalink:"/Tutorials/Fragments/Fragments/IfcImporter/HelloWorldSchema"}},l={},c=[{value:"Converting IFC to Fragments \ud83d\ude00",id:"converting-ifc-to-fragments-",level:2},{value:"\ud83d\udd96 Importing our Libraries",id:"-importing-our-libraries",level:3},{value:"\ud83c\udf0e Setting up a Simple Scene",id:"-setting-up-a-simple-scene",level:3},{value:"Converting IFCs \ud83d\ude80",id:"converting-ifcs-",level:3},{value:"\ud83d\udee0\ufe0f Setting Up Fragments",id:"\ufe0f-setting-up-fragments",level:3},{value:"Loading a Fragments Model \ud83d\udea7",id:"loading-a-fragments-model-",level:3},{value:"\ud83e\udde9 Adding User Interface (optional)",id:"-adding-user-interface-optional",level:3},{value:"\u23f1\ufe0f Measuring the performance (optional)",id:"\ufe0f-measuring-the-performance-optional",level:3},{value:"\ud83c\udf89 Congratulations!",id:"-congratulations",level:3}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",hr:"hr",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{style:{position:"relative"},children:[(0,o.jsx)("iframe",{src:"https://thatopen.github.io/engine_fragment/examples/IfcImporter"}),(0,o.jsx)("button",{class:"full-screen-btn",onClick:()=>window.open("https://thatopen.github.io/engine_fragment/examples/IfcImporter"),children:"Go Full Screen"})]}),"\n",(0,o.jsx)(n.admonition,{title:"Source",type:"info",children:(0,o.jsxs)(n.p,{children:["Copying and pasting? We've got you covered! You can find the full source code of this tutorial ",(0,o.jsx)(n.a,{href:"https://github.com/ThatOpen/engine_fragment/blob/main/packages/fragments/src/Importers/IfcImporter/example.ts",children:"here"}),"."]})}),"\n",(0,o.jsx)(n.h2,{id:"converting-ifc-to-fragments-",children:"Converting IFC to Fragments \ud83d\ude00"}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.p,{children:"In this tutorial, we'll learn how to convert large and complex IFC files into the lightweight, modern binary BIM data that we call Fragments for high-performance applications. Let's get started!"}),"\n",(0,o.jsx)(n.h3,{id:"-importing-our-libraries",children:"\ud83d\udd96 Importing our Libraries"}),"\n",(0,o.jsx)(n.p,{children:"First things first, let's install all necessary dependencies to make this example work:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'import * as OBC from "@thatopen/components";\nimport * as BUI from "@thatopen/ui";\nimport Stats from "stats.js";\n// You have to import * as FRAGS from "@thatopen/fragments"\nimport * as FRAGS from "../..";\n'})}),"\n",(0,o.jsx)(n.h3,{id:"-setting-up-a-simple-scene",children:"\ud83c\udf0e Setting up a Simple Scene"}),"\n",(0,o.jsx)(n.p,{children:"To get started, let's set up a basic ThreeJS scene. This will serve as the foundation for our application and allow us to visualize the 3D models effectively:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'const components = new OBC.Components();\n\nconst worlds = components.get(OBC.Worlds);\nconst world = worlds.create<\n  OBC.SimpleScene,\n  OBC.SimpleCamera,\n  OBC.SimpleRenderer\n>();\n\nworld.scene = new OBC.SimpleScene(components);\nworld.scene.setup();\nworld.scene.three.background = null;\n\nconst container = document.getElementById("container")!;\nworld.renderer = new OBC.SimpleRenderer(components, container);\n\nworld.camera = new OBC.SimpleCamera(components);\nworld.camera.controls.setLookAt(74, 16, 0.2, 30, -4, 27); // convenient position for the model we will load\n\ncomponents.init();\n\nconst grids = components.get(OBC.Grids);\ngrids.create(world);\n'})}),"\n",(0,o.jsx)(n.admonition,{title:"Do I need @thatopen/components?",type:"info",children:(0,o.jsx)(n.p,{children:"Not necessarily! While @thatopen/components simplifies the process of setting up a scene, you can always use plain ThreeJS to create your own custom scene setup. It's entirely up to your preference and project requirements! \ud83d\ude09"})}),"\n",(0,o.jsx)(n.h3,{id:"converting-ifcs-",children:"Converting IFCs \ud83d\ude80"}),"\n",(0,o.jsx)(n.p,{children:"The IfcImporter is your gateway to converting IFC files into Fragments, enabling you to build high-performance BIM applications effortlessly. With just a few lines of code, you can transform complex IFC data into lightweight, modern Fragments. Let's dive in and make it happen!"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'const serializer = new FRAGS.IfcImporter();\nserializer.wasm = { absolute: true, path: "https://unpkg.com/web-ifc@0.0.72/" };\n// A convenient variable to hold the ArrayBuffer data loaded into memory\nlet fragmentBytes: ArrayBuffer | null = null;\nlet onConversionFinish = () => {};\n\nconst convertIFC = async () => {\n  const url =\n    "https://thatopen.github.io/engine_fragment/resources/ifc/school_str.ifc";\n  const ifcFile = await fetch(url);\n  const ifcBuffer = await ifcFile.arrayBuffer();\n  const ifcBytes = new Uint8Array(ifcBuffer);\n  fragmentBytes = await serializer.process({\n    bytes: ifcBytes,\n    progressCallback: (progress, data) => console.log(progress, data),\n  });\n  onConversionFinish();\n};\n'})}),"\n",(0,o.jsx)(n.h3,{id:"\ufe0f-setting-up-fragments",children:"\ud83d\udee0\ufe0f Setting Up Fragments"}),"\n",(0,o.jsx)(n.p,{children:"Now, let's configure the Fragments library core. This will allow us to load the converted files effortlessly and start manipulating them with ease:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'// You have to copy `/node_modules/@thatopen/fragments/dist/Worker/worker.mjs` to your project directory\n// and provide the relative path in `workerUrl`\n// We use here the internal route of the worker in the library for simplicity purposes\nconst workerUrl =\n  "https://thatopen.github.io/engine_fragment/resources/worker.mjs";\nconst fragments = new FRAGS.FragmentsModels(workerUrl);\nworld.camera.controls.addEventListener("rest", () => fragments.update(true));\n'})}),"\n",(0,o.jsx)(n.h3,{id:"loading-a-fragments-model-",children:"Loading a Fragments Model \ud83d\udea7"}),"\n",(0,o.jsx)(n.p,{children:"With the core already set up, let's create a simple function to load the Fragments Model from the binary data and add it to the scene. This function ensures seamless integration of the converted model into our application:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'const loadModel = async () => {\n  if (!fragmentBytes) return;\n  const model = await fragments.load(fragmentBytes, { modelId: "example" });\n  model.useCamera(world.camera.three);\n  world.scene.three.add(model.object);\n  await fragments.update(true);\n};\n'})}),"\n",(0,o.jsx)(n.p,{children:"To ensure optimal performance and prevent memory leaks, it's important to handle model disposal properly. Here's how we can do it:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'const removeModel = async () => {\n  await fragments.disposeModel("example");\n};\n'})}),"\n",(0,o.jsx)(n.h3,{id:"-adding-user-interface-optional",children:"\ud83e\udde9 Adding User Interface (optional)"}),"\n",(0,o.jsxs)(n.p,{children:["We will use the ",(0,o.jsx)(n.code,{children:"@thatopen/ui"})," library to add some simple and cool UI elements to our app. First, we need to call the ",(0,o.jsx)(n.code,{children:"init"})," method of the ",(0,o.jsx)(n.code,{children:"BUI.Manager"})," class to initialize the library:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"BUI.Manager.init();\n"})}),"\n",(0,o.jsx)(n.p,{children:"Now we will add some UI to handle the logic of this tutorial. For more information about the UI library, you can check the specific documentation for it!"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'const [panel, updatePanel] = BUI.Component.create<BUI.PanelSection, any>(\n  (_) => {\n    const onDownload = () => {\n      if (!fragmentBytes) return;\n      const file = new File([fragmentBytes], "sample.frag");\n      const a = document.createElement("a");\n      a.href = URL.createObjectURL(file);\n      a.download = file.name;\n      a.click();\n      URL.revokeObjectURL(a.href);\n    };\n\n    let content = BUI.html`\n      <bim-label style="white-space: normal;">\ud83d\udca1 Open the console to see more information</bim-label>\n      <bim-button label="Load IFC" @click=${convertIFC}></bim-button>\n    `;\n    if (fragmentBytes) {\n      content = BUI.html`\n        <bim-label style="white-space: normal;">\ud83d\ude80 The IFC has been converted to Fragments binary data. Add the model to the scene!</bim-label>\n        <bim-button label="Add Model" @click=${loadModel}></bim-button>\n        <bim-button label="Remove Model" @click=${removeModel}></bim-button>\n        <bim-button label="Download Fragments" @click=${onDownload}></bim-button>\n      `;\n    }\n\n    return BUI.html`\n    <bim-panel id="controls-panel" active label="IFC Importer" class="options-menu">\n      <bim-panel-section label="Controls">\n        ${content}\n      </bim-panel-section>\n    </bim-panel>\n  `;\n  },\n  {},\n);\n\nonConversionFinish = () => updatePanel();\nfragments.models.list.onItemDeleted.add(() => updatePanel());\n\ndocument.body.append(panel);\n'})}),"\n",(0,o.jsx)(n.p,{children:"And we will make some logic that adds a button to the screen when the user is visiting our app from their phone, allowing to show or hide the menu. Otherwise, the menu would make the app unusable."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'const button = BUI.Component.create<BUI.PanelSection>(() => {\n  const onClick = () => {\n    if (panel.classList.contains("options-menu-visible")) {\n      panel.classList.remove("options-menu-visible");\n    } else {\n      panel.classList.add("options-menu-visible");\n    }\n  };\n\n  return BUI.html`\n    <bim-button class="phone-menu-toggler" icon="solar:settings-bold"\n      @click=${onClick}>\n    </bim-button>\n  `;\n});\n\ndocument.body.append(button);\n'})}),"\n",(0,o.jsx)(n.h3,{id:"\ufe0f-measuring-the-performance-optional",children:"\u23f1\ufe0f Measuring the performance (optional)"}),"\n",(0,o.jsxs)(n.p,{children:["We'll use the ",(0,o.jsx)(n.a,{href:"https://github.com/mrdoob/stats.js",children:"Stats.js"})," to measure the performance of our app. We will add it to the top left corner of the viewport. This way, we'll make sure that the memory consumption and the FPS of our app are under control."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'const stats = new Stats();\nstats.showPanel(2);\ndocument.body.append(stats.dom);\nstats.dom.style.left = "0px";\nstats.dom.style.zIndex = "unset";\nworld.renderer.onBeforeUpdate.add(() => stats.begin());\nworld.renderer.onAfterUpdate.add(() => stats.end());\n'})}),"\n",(0,o.jsx)(n.h3,{id:"-congratulations",children:"\ud83c\udf89 Congratulations!"}),"\n",(0,o.jsx)(n.p,{children:"You've successfully completed this tutorial on converting complex IFC models into lightweight and efficient Fragments Models! \ud83d\ude80\nNow you can leverage this knowledge to build high-performance BIM applications with ease. Happy coding! \ud83c\udf8a"})]})}function m(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>i});var o=t(6540);const r={},a=o.createContext(r);function s(e){const n=o.useContext(a);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),o.createElement(a.Provider,{value:n},e.children)}}}]);