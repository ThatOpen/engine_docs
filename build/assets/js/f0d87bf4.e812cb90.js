"use strict";(self.webpackChunkengine_docs=self.webpackChunkengine_docs||[]).push([[8444],{8117:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>m,frontMatter:()=>a,metadata:()=>r,toc:()=>c});var o=t(4848),s=t(8453);const a={},i=void 0,r={id:"Tutorials/Components/Core/IfcLoader",title:"IfcLoader",description:'window.open("https://thatopen.github.io/engine_components/examples/IfcLoader")} >Go Full Screen',source:"@site/docs/Tutorials/Components/Core/IfcLoader.mdx",sourceDirName:"Tutorials/Components/Core",slug:"/Tutorials/Components/Core/IfcLoader",permalink:"/Tutorials/Components/Core/IfcLoader",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"IDSSpecifications",permalink:"/Tutorials/Components/Core/IDSSpecifications"},next:{title:"ItemsFinder",permalink:"/Tutorials/Components/Core/ItemsFinder"}},l={},c=[{value:"\ud83d\udcc4 Loading IFC Models",id:"-loading-ifc-models",level:2},{value:"\ud83d\udd96 Importing our Libraries",id:"-importing-our-libraries",level:3},{value:"\ud83c\udf0e Setting up a Simple Scene",id:"-setting-up-a-simple-scene",level:3},{value:"\u2728 Using The IfcLoader Component",id:"-using-the-ifcloader-component",level:3},{value:"\ud83c\udf81 Exporting the Fragments Model",id:"-exporting-the-fragments-model",level:3},{value:"\ud83e\udde9 Adding some UI (optional but recommended)",id:"-adding-some-ui-optional-but-recommended",level:3},{value:"\u23f1\ufe0f Measuring the performance (optional)",id:"\ufe0f-measuring-the-performance-optional",level:3},{value:"\ud83c\udf89 Wrap up",id:"-wrap-up",level:3}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",hr:"hr",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{style:{position:"relative"},children:[(0,o.jsx)("iframe",{src:"https://thatopen.github.io/engine_components/examples/IfcLoader"}),(0,o.jsx)("button",{class:"full-screen-btn",onClick:()=>window.open("https://thatopen.github.io/engine_components/examples/IfcLoader"),children:"Go Full Screen"})]}),"\n",(0,o.jsx)(n.admonition,{title:"Source",type:"info",children:(0,o.jsxs)(n.p,{children:["Copying and pasting? We've got you covered! You can find the full source code of this tutorial ",(0,o.jsx)(n.a,{href:"https://github.com/ThatOpen/engine_components/blob/main/packages/core/src/fragments/IfcLoader/example.ts",children:"here"}),"."]})}),"\n",(0,o.jsx)(n.h2,{id:"-loading-ifc-models",children:"\ud83d\udcc4 Loading IFC Models"}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.p,{children:"IFC is the most common format to share BIM data openly. Our libraries are able to load, navigate and even create and edit them directly. In this tutorial, you'll learn how to open an IFC model in the 3D scene."}),"\n",(0,o.jsx)(n.admonition,{title:"IFC?",type:"tip",children:(0,o.jsx)(n.p,{children:"If you are not famliar with the construction industry, this might be the first time you come across this term. It stands for Industry Foundation Classes, and it's the most widespread standard for sharing BIM data freely, without depending on specific software manufacturers and their propietary formats."})}),"\n",(0,o.jsx)(n.h3,{id:"-importing-our-libraries",children:"\ud83d\udd96 Importing our Libraries"}),"\n",(0,o.jsx)(n.p,{children:"First things first, let's install all necessary dependencies to make this example work:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'import Stats from "stats.js";\nimport * as BUI from "@thatopen/ui";\n// You have to import * as OBC from "@thatopen/components"\nimport * as OBC from "../..";\n'})}),"\n",(0,o.jsx)(n.h3,{id:"-setting-up-a-simple-scene",children:"\ud83c\udf0e Setting up a Simple Scene"}),"\n",(0,o.jsx)(n.p,{children:"To get started, let's set up a basic ThreeJS scene. This will serve as the foundation for our application and allow us to visualize the 3D models effectively:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'const components = new OBC.Components();\n\nconst worlds = components.get(OBC.Worlds);\nconst world = worlds.create<\n  OBC.SimpleScene,\n  OBC.OrthoPerspectiveCamera,\n  OBC.SimpleRenderer\n>();\n\nworld.scene = new OBC.SimpleScene(components);\nworld.scene.setup();\nworld.scene.three.background = null;\n\nconst container = document.getElementById("container")!;\nworld.renderer = new OBC.SimpleRenderer(components, container);\nworld.camera = new OBC.OrthoPerspectiveCamera(components);\nawait world.camera.controls.setLookAt(78, 20, -2.2, 26, -4, 25);\n\ncomponents.init();\n\ncomponents.get(OBC.Grids).create(world);\n'})}),"\n",(0,o.jsx)(n.h3,{id:"-using-the-ifcloader-component",children:"\u2728 Using The IfcLoader Component"}),"\n",(0,o.jsx)(n.p,{children:'With the basic world already set up, it\'s now time to bring it to life by loading some IFC files. That Open Engine does not directly load IFC files. When an IFC file is "loaded", the engine first converts it into something called Fragments and then loads it into the scene. The model you see is the result of this process.'}),"\n",(0,o.jsx)(n.admonition,{title:"Fragments?",type:"info",children:(0,o.jsx)(n.p,{children:"Fragments are That Open Company's open-source binary format for storing BIM models. They are built on top of Flatbuffers from Google, making them lightweight and highly efficient for storing vast amounts of BIM data."})}),"\n",(0,o.jsx)(n.p,{children:"All That Open Engine works on top of Fragments, and that's why the conversion process must take place. So, let's start by getting the component instance:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"const ifcLoader = components.get(OBC.IfcLoader);\n"})}),"\n",(0,o.jsx)(n.admonition,{title:"What elements of IFC get converted to Fragments?",type:"warning",children:(0,o.jsxs)(n.p,{children:["For memory efficiency reasons, we don't convert each an every element to fragments by default. You can see the list in IfcImporter.classes and check out the full list ",(0,o.jsx)(n.a,{href:"https://github.com/ThatOpen/engine_fragment/blob/main/packages/fragments/src/Importers/IfcImporter/src/classes.ts",children:"here"}),". If you convert an IFC to fragments and miss some elements, you probably need to add their IFC classes to the list. You can access the importer instance in the onIfcImporterInitialized event."]})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"ifcLoader.onIfcImporterInitialized.add((importer) => {\n  console.log(importer.classes);\n});\n"})}),"\n",(0,o.jsx)(n.p,{children:"With the loader in place, it needs to be properly configured. This involves setting up web-ifc (the core library responsible for reading IFC files) to ensure it is ready to convert IFC files into Fragments:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'await ifcLoader.setup({\n  autoSetWasm: false,\n  wasm: {\n    path: "https://unpkg.com/web-ifc@0.0.72/",\n    absolute: true,\n  },\n});\n'})}),"\n",(0,o.jsx)(n.p,{children:'When an IFC file is converted to Fragments, another component handles the converted file: the FragmentsManager. Therefore, it is essential to configure this component first before attempting to "load" any IFC file:'}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'const workerUrl =\n  "https://thatopen.github.io/engine_fragment/resources/worker.mjs";\nconst fragments = components.get(OBC.FragmentsManager);\nfragments.init(workerUrl);\n\nworld.camera.controls.addEventListener("rest", () =>\n  fragments.core.update(true),\n);\n\n// Ensures that once the Fragments model is loaded\n// (converted from the IFC in this case),\n// it utilizes the world camera for updates\n// and is added to the scene.\nfragments.list.onItemSet.add(({ value: model }) => {\n  model.useCamera(world.camera.three);\n  world.scene.three.add(model.object);\n  fragments.core.update(true);\n});\n'})}),"\n",(0,o.jsx)(n.admonition,{title:"Need more details?",type:"info",children:(0,o.jsx)(n.p,{children:"For additional information about the FragmentsManager, refer to the corresponding component tutorial available in the documentation."})}),"\n",(0,o.jsx)(n.p,{children:"Great! With everything configured, let's proceed to create a function that will load an IFC model into the viewer:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'const loadIfc = async (path: string) => {\n  const file = await fetch(path);\n  const data = await file.arrayBuffer();\n  const buffer = new Uint8Array(data);\n  await ifcLoader.load(buffer, false, "example", {\n    processData: {\n      progressCallback: (progress) => console.log(progress),\n    },\n  });\n};\n'})}),"\n",(0,o.jsx)(n.admonition,{title:"Personalized Conversion",type:"info",children:(0,o.jsx)(n.p,{children:"The IfcLoader component provides a quick and convenient way to convert IFC files into Fragments and load them into the engine. However, for greater control over the conversion process, it is recommended to use the Fragments library directly. The conversion mechanism is the same, but the core library offers a less abstracted approach."})}),"\n",(0,o.jsx)(n.p,{children:"Once the file is loaded, you can leverage any of the engine's components to interact with it. Each component is a specialized tool designed for specific tasks with Fragment Models. There are components for measurements, model classification, visibility operations, plan generation, and much more. Check out the full documentation to learn more!"}),"\n",(0,o.jsx)(n.h3,{id:"-exporting-the-fragments-model",children:"\ud83c\udf81 Exporting the Fragments Model"}),"\n",(0,o.jsx)(n.p,{children:"The primary goal of this process is to load the Fragments Model instead of the IFC file. This approach is more efficient because the time-consuming part is the conversion process, not the actual loading of the model into the scene. So, how can you obtain the Fragments Model resulting from the conversion? It's simple! Here's how:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'const downloadFragments = async () => {\n  // fragments.list holds all the fragments loaded\n  const [model] = fragments.list.values();\n  if (!model) return;\n  const fragsBuffer = await model.getBuffer(false);\n  const file = new File([fragsBuffer], "school_str.frag");\n  const link = document.createElement("a");\n  link.href = URL.createObjectURL(file);\n  link.download = file.name;\n  link.click();\n  URL.revokeObjectURL(link.href);\n};\n'})}),"\n",(0,o.jsx)(n.p,{children:"Now that you can download the Fragments Model, what's next? You should continue loading this file instead of the original IFC file. To learn how to consistently load Fragments Models instead of the original IFC file, refer to the FragmentsManager tutorial."}),"\n",(0,o.jsx)(n.h3,{id:"-adding-some-ui-optional-but-recommended",children:"\ud83e\udde9 Adding some UI (optional but recommended)"}),"\n",(0,o.jsxs)(n.p,{children:["We will use the ",(0,o.jsx)(n.code,{children:"@thatopen/ui"})," library to add some simple and cool UI elements to our app. First, we need to call the ",(0,o.jsx)(n.code,{children:"init"})," method of the ",(0,o.jsx)(n.code,{children:"BUI.Manager"})," class to initialize the library:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"BUI.Manager.init();\n"})}),"\n",(0,o.jsx)(n.p,{children:"Now we will add some UI to play around with the actions in this tutorial. For more information about the UI library, you can check the specific documentation for it!"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'const [panel, updatePanel] = BUI.Component.create<BUI.PanelSection, {}>((_) => {\n  let downloadBtn: BUI.TemplateResult | undefined;\n  if (fragments.list.size > 0) {\n    downloadBtn = BUI.html`\n      <bim-button label="Download Fragments" @click=${downloadFragments}></bim-button>\n    `;\n  }\n\n  let loadBtn: BUI.TemplateResult | undefined;\n  if (fragments.list.size === 0) {\n    const onLoadIfc = async ({ target }: { target: BUI.Button }) => {\n      target.label = "Conversion in progress...";\n      target.loading = true;\n      await loadIfc("https://thatopen.github.io/engine_components/resources/ifc/school_str.ifc");\n      target.loading = false;\n      target.label = "Load IFC";\n    };\n\n    loadBtn = BUI.html`\n      <bim-button label="Load IFC" @click=${onLoadIfc}></bim-button>\n      <bim-label>Open the console to see the progress!</bim-label>\n    `;\n  }\n\n  return BUI.html`\n    <bim-panel active label="IfcLoader Tutorial" class="options-menu">\n      <bim-panel-section label="Controls">\n        ${loadBtn}\n        ${downloadBtn}\n      </bim-panel-section>\n    </bim-panel>\n  `;\n}, {});\n\ndocument.body.append(panel);\nfragments.list.onItemSet.add(() => updatePanel());\n'})}),"\n",(0,o.jsx)(n.p,{children:"And we will make some logic that adds a button to the screen when the user is visiting our app from their phone, allowing to show or hide the menu. Otherwise, the menu would make the app unusable."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'const button = BUI.Component.create<BUI.PanelSection>(() => {\n  return BUI.html`\n      <bim-button class="phone-menu-toggler" icon="solar:settings-bold"\n        @click="${() => {\n          if (panel.classList.contains("options-menu-visible")) {\n            panel.classList.remove("options-menu-visible");\n          } else {\n            panel.classList.add("options-menu-visible");\n          }\n        }}">\n      </bim-button>\n    `;\n});\n\ndocument.body.append(button);\n'})}),"\n",(0,o.jsx)(n.h3,{id:"\ufe0f-measuring-the-performance-optional",children:"\u23f1\ufe0f Measuring the performance (optional)"}),"\n",(0,o.jsxs)(n.p,{children:["We'll use the ",(0,o.jsx)(n.a,{href:"https://github.com/mrdoob/stats.js",children:"Stats.js"})," to measure the performance of our app. We will add it to the top left corner of the viewport. This way, we'll make sure that the memory consumption and the FPS of our app are under control."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'const stats = new Stats();\nstats.showPanel(2);\ndocument.body.append(stats.dom);\nstats.dom.style.left = "0px";\nstats.dom.style.zIndex = "unset";\nworld.renderer.onBeforeUpdate.add(() => stats.begin());\nworld.renderer.onAfterUpdate.add(() => stats.end());\n'})}),"\n",(0,o.jsx)(n.h3,{id:"-wrap-up",children:"\ud83c\udf89 Wrap up"}),"\n",(0,o.jsx)(n.p,{children:"That's it! Now you're able to load IFC models, convert them to Fragments, and interact with them in a 3D scene. Congratulations! Keep going with more tutorials in the documentation."})]})}function m(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>r});var o=t(6540);const s={},a=o.createContext(s);function i(e){const n=o.useContext(a);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),o.createElement(a.Provider,{value:n},e.children)}}}]);