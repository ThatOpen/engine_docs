"use strict";(self.webpackChunkengine_docs=self.webpackChunkengine_docs||[]).push([[9239],{4348:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>m,frontMatter:()=>s,metadata:()=>a,toc:()=>c});var r=t(4848),i=t(8453);const s={},o=void 0,a={id:"Tutorials/Components/Core/ItemsFinder",title:"ItemsFinder",description:'window.open("https://thatopen.github.io/engine_components/examples/ItemsFinder")} >Go Full Screen',source:"@site/docs/Tutorials/Components/Core/ItemsFinder.mdx",sourceDirName:"Tutorials/Components/Core",slug:"/Tutorials/Components/Core/ItemsFinder",permalink:"/Tutorials/Components/Core/ItemsFinder",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"IfcLoader",permalink:"/Tutorials/Components/Core/IfcLoader"},next:{title:"OrthoPerspectiveCamera",permalink:"/Tutorials/Components/Core/OrthoPerspectiveCamera"}},l={},c=[{value:"\ud83d\udcc4 Finding the Items you Need",id:"-finding-the-items-you-need",level:2},{value:"\ud83d\udd96 Importing our Libraries",id:"-importing-our-libraries",level:3},{value:"\ud83c\udf0e Setting up a Simple Scene",id:"-setting-up-a-simple-scene",level:3},{value:"\ud83d\udee0\ufe0f Setting Up Fragments",id:"\ufe0f-setting-up-fragments",level:3},{value:"\ud83d\udcc2 Loading Fragments Models",id:"-loading-fragments-models",level:3},{value:"\u2728 Using The Items Finder Component",id:"-using-the-items-finder-component",level:3},{value:"\ud83e\udde9 Adding some UI (optional but recommended)",id:"-adding-some-ui-optional-but-recommended",level:3},{value:"\u23f1\ufe0f Measuring the performance (optional)",id:"\ufe0f-measuring-the-performance-optional",level:3},{value:"\ud83c\udf89 Wrap up",id:"-wrap-up",level:3}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",hr:"hr",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{style:{position:"relative"},children:[(0,r.jsx)("iframe",{src:"https://thatopen.github.io/engine_components/examples/ItemsFinder"}),(0,r.jsx)("button",{class:"full-screen-btn",onClick:()=>window.open("https://thatopen.github.io/engine_components/examples/ItemsFinder"),children:"Go Full Screen"})]}),"\n",(0,r.jsx)(n.admonition,{title:"Source",type:"info",children:(0,r.jsxs)(n.p,{children:["Copying and pasting? We've got you covered! You can find the full source code of this tutorial ",(0,r.jsx)(n.a,{href:"https://github.com/ThatOpen/engine_components/blob/main/packages/core/src/fragments/ItemsFinder/example.ts",children:"here"}),"."]})}),"\n",(0,r.jsx)(n.h2,{id:"-finding-the-items-you-need",children:"\ud83d\udcc4 Finding the Items you Need"}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.p,{children:"In the world of 3D modeling, finding the right information quickly is crucial for efficiency and productivity. The Items Finder component empowers you to locate specific elements in your models with ease, using powerful queries based on categories, attributes, and relationships. Let's dive in and see how it works!"}),"\n",(0,r.jsx)(n.h3,{id:"-importing-our-libraries",children:"\ud83d\udd96 Importing our Libraries"}),"\n",(0,r.jsx)(n.p,{children:"First things first, let's install all necessary dependencies to make this example work:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:'import * as FRAGS from "@thatopen/fragments";\nimport Stats from "stats.js";\nimport * as BUI from "@thatopen/ui";\n// You have to import * as OBC from "@thatopen/components"\nimport * as OBC from "../..";\n'})}),"\n",(0,r.jsx)(n.h3,{id:"-setting-up-a-simple-scene",children:"\ud83c\udf0e Setting up a Simple Scene"}),"\n",(0,r.jsx)(n.p,{children:"To get started, let's set up a basic ThreeJS scene. This will serve as the foundation for our application and allow us to visualize the 3D models effectively:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:'const components = new OBC.Components();\n\nconst worlds = components.get(OBC.Worlds);\nconst world = worlds.create<\n  OBC.SimpleScene,\n  OBC.OrthoPerspectiveCamera,\n  OBC.SimpleRenderer\n>();\n\nworld.scene = new OBC.SimpleScene(components);\nworld.scene.setup();\nworld.scene.three.background = null;\n\nconst container = document.getElementById("container")!;\nworld.renderer = new OBC.SimpleRenderer(components, container);\nworld.camera = new OBC.OrthoPerspectiveCamera(components);\nawait world.camera.controls.setLookAt(78, 20, -2.2, 26, -4, 25);\n\ncomponents.init();\n'})}),"\n",(0,r.jsx)(n.h3,{id:"\ufe0f-setting-up-fragments",children:"\ud83d\udee0\ufe0f Setting Up Fragments"}),"\n",(0,r.jsx)(n.p,{children:"Now, let's configure the FragmentsManager. This will allow us to load models effortlessly and start manipulating them with ease:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:'const githubUrl =\n  "https://thatopen.github.io/engine_fragment/resources/worker.mjs";\nconst fetchedUrl = await fetch(githubUrl);\nconst workerBlob = await fetchedUrl.blob();\nconst workerFile = new File([workerBlob], "worker.mjs", {\n  type: "text/javascript",\n});\nconst workerUrl = URL.createObjectURL(workerFile);\nconst fragments = components.get(OBC.FragmentsManager);\nfragments.init(workerUrl);\n\nworld.camera.controls.addEventListener("rest", () =>\n  fragments.core.update(true),\n);\n\nworld.onCameraChanged.add((camera) => {\n  for (const [, model] of fragments.list) {\n    model.useCamera(camera.three);\n  }\n  fragments.core.update(true);\n});\n\nfragments.list.onItemSet.add(({ value: model }) => {\n  model.useCamera(world.camera.three);\n  world.scene.three.add(model.object);\n  fragments.core.update(true);\n});\n'})}),"\n",(0,r.jsx)(n.h3,{id:"-loading-fragments-models",children:"\ud83d\udcc2 Loading Fragments Models"}),"\n",(0,r.jsx)(n.p,{children:"With the core setup complete, it's time to load a Fragments model into our scene. Fragments are optimized for fast loading and rendering, making them ideal for large-scale 3D models."}),"\n",(0,r.jsx)(n.admonition,{title:"Where can I find Fragment files?",type:"info",children:(0,r.jsx)(n.p,{children:"You can use the sample Fragment files available in our repository for testing. If you have an IFC model you'd like to convert to Fragments, check out the IfcImporter tutorial for detailed instructions."})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:'const fragPaths = [\n  "https://thatopen.github.io/engine_components/resources/frags/school_arq.frag",\n  "https://thatopen.github.io/engine_components/resources/frags/school_str.frag",\n];\n\nawait Promise.all(\n  fragPaths.map(async (path) => {\n    const modelId = path.split("/").pop()?.split(".").shift();\n    if (!modelId) return null;\n    const file = await fetch(path);\n    const buffer = await file.arrayBuffer();\n    return fragments.core.load(buffer, { modelId });\n  }),\n);\n'})}),"\n",(0,r.jsx)(n.h3,{id:"-using-the-items-finder-component",children:"\u2728 Using The Items Finder Component"}),"\n",(0,r.jsx)(n.p,{children:"Using the Items Finder component is straightforward. The only thing you need to focus on is understanding the types of attributes and relationships your model may have, as well as the values you expect from them. The rest is handled automatically by the component itself. Let's begin by obtaining the component instance:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"const finder = components.get(OBC.ItemsFinder);\n"})}),"\n",(0,r.jsx)(n.p,{children:"When using the finder, you create queries to locate the items you are searching for. Essentially, you can search based on three criteria: categories, attributes, and relationships. While this may seem limited, it is far more powerful than you might think. Let's create a few queries using one or more of these criteria. We'll start by searching for categories:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:'finder.create("Walls & Slabs", [{ categories: [/WALL/, /SLAB/] }]);\n'})}),"\n",(0,r.jsx)(n.admonition,{title:"Storing Queries",type:"note",children:(0,r.jsxs)(n.p,{children:["When you create queries, as demonstrated earlier, the query data is automatically stored within the Items Finder component under its ",(0,r.jsx)(n.code,{children:"list"})," property."]})}),"\n",(0,r.jsx)(n.p,{children:"When searching for categories as shown earlier, the result will include all items matching any of the specified categories. This is because a single item cannot belong to more than one category. To make things more interesting, let's search for all items that match specific criteria in their attributes:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:'finder.create("Masonry Walls", [\n  {\n    categories: [/WALL/],\n    attributes: { queries: [{ name: /Name/, value: /Masonry/ }] },\n  },\n]);\n'})}),"\n",(0,r.jsx)(n.p,{children:'As demonstrated, we are now searching for walls that include the word "Masonry" in their "Name" attribute. Note that both the name and value of the attribute are defined using regular expressions. This approach offers greater flexibility in specifying search criteria.'}),"\n",(0,r.jsx)(n.admonition,{title:"Additional Attribute Types",type:"tip",children:(0,r.jsx)(n.p,{children:"For improved flexibility, attribute values can also be numbers, booleans, or arrays of regular expressions."})}),"\n",(0,r.jsx)(n.p,{children:"To keep making things even more interesting, let's create a query that is able to find the items that relates with another under some conditions:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:'// First, define a query to find building storeys\n// where the Name attribute contains the word "Entry".\nconst entryLevel: FRAGS.ItemsQueryParams = {\n  categories: [/BUILDINGSTOREY/],\n  attributes: { queries: [{ name: /Name/, value: /Entry/ }] },\n};\n\n// Next, we retrieve all columns that are related\n// to any item matching the entryLevel query under the\n// relation named ContainedInStructure.\nfinder.create("First Level Columns", [\n  {\n    categories: [/COLUMN/],\n    relation: { name: "ContainedInStructure", query: entryLevel },\n  },\n]);\n'})}),"\n",(0,r.jsx)(n.p,{children:"As demonstrated, this approach can become incredibly powerful with minimal code, as long as you understand the expected attribute types and the relationships within your model."}),"\n",(0,r.jsx)(n.admonition,{title:"IFC Schema",type:"note",children:(0,r.jsx)(n.p,{children:"If your Fragment Models implement the IFC schema, refer to the buildingSMART documentation to learn more about the available attributes and relationship types."})}),"\n",(0,r.jsxs)(n.p,{children:["Lastly, let's create a helper function to return the ",(0,r.jsx)(n.code,{children:"modelIdMap"})," result of the query:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"const getResult = async (name: string) => {\n  const finderQuery = finder.list.get(name);\n  if (!finderQuery) return {};\n  const result = await finderQuery.test();\n  return result;\n};\n"})}),"\n",(0,r.jsx)(n.h3,{id:"-adding-some-ui-optional-but-recommended",children:"\ud83e\udde9 Adding some UI (optional but recommended)"}),"\n",(0,r.jsxs)(n.p,{children:["We will use the ",(0,r.jsx)(n.code,{children:"@thatopen/ui"})," library to add some simple and cool UI elements to our app. First, we need to call the ",(0,r.jsx)(n.code,{children:"init"})," method of the ",(0,r.jsx)(n.code,{children:"BUI.Manager"})," class to initialize the library:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"BUI.Manager.init();\n"})}),"\n",(0,r.jsx)(n.p,{children:"Now we will add some UI to play around with the actions in this tutorial. For more information about the UI library, you can check the specific documentation for it!"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:'type QueriesListTableData = {\n  Name: string;\n  Actions: string;\n};\n\nconst queriesListTemplate = () => {\n  const onCreated = (e?: Element) => {\n    if (!e) return;\n    const table = e as BUI.Table<QueriesListTableData>;\n\n    table.loadFunction = async () => {\n      const data: BUI.TableGroupData<QueriesListTableData>[] = [];\n\n      for (const [name] of finder.list) {\n        data.push({\n          data: { Name: name, Actions: "" },\n        });\n      }\n\n      return data;\n    };\n\n    table.loadData(true);\n  };\n\n  return BUI.html`\n    <bim-table ${BUI.ref(onCreated)}></bim-table>\n  `;\n};\n\nconst queriesList =\n  BUI.Component.create<BUI.Table<QueriesListTableData>>(queriesListTemplate);\n\nqueriesList.style.maxHeight = "25rem";\nqueriesList.columns = ["Name", { name: "Actions", width: "auto" }];\nqueriesList.noIndentation = true;\nqueriesList.headersHidden = true;\nqueriesList.dataTransform = {\n  Actions: (_, rowData) => {\n    const { Name } = rowData;\n    if (!Name) return _;\n\n    const hider = components.get(OBC.Hider);\n    const onClick = async ({ target }: { target: BUI.Button }) => {\n      target.loading = true;\n      const modelIdMap = await getResult(Name);\n      await hider.isolate(modelIdMap);\n      target.loading = false;\n    };\n\n    return BUI.html`<bim-button icon="solar:cursor-bold" @click=${onClick}></bim-button>`;\n  },\n};\n\nconst panel = BUI.Component.create<BUI.PanelSection>(() => {\n  const onResetVisibility = async ({ target }: { target: BUI.Button }) => {\n    target.loading = true;\n    const hider = components.get(OBC.Hider);\n    await hider.set(true);\n    target.loading = false;\n  };\n\n  return BUI.html`\n    <bim-panel active label="Items Finder Tutorial" class="options-menu">\n      <bim-panel-section style="min-width: 14rem" label="General">\n        <bim-button label="Reset Visibility" @click=${onResetVisibility}></bim-button>\n      </bim-panel-section>\n      <bim-panel-section label="Queries">\n        ${queriesList}\n      </bim-panel-section>\n    </bim-panel>\n  `;\n});\n\ndocument.body.append(panel);\n'})}),"\n",(0,r.jsx)(n.p,{children:"And we will make some logic that adds a button to the screen when the user is visiting our app from their phone, allowing to show or hide the menu. Otherwise, the menu would make the app unusable."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:'const button = BUI.Component.create<BUI.PanelSection>(() => {\n  return BUI.html`\n      <bim-button class="phone-menu-toggler" icon="solar:settings-bold"\n        @click="${() => {\n          if (panel.classList.contains("options-menu-visible")) {\n            panel.classList.remove("options-menu-visible");\n          } else {\n            panel.classList.add("options-menu-visible");\n          }\n        }}">\n      </bim-button>\n    `;\n});\n\ndocument.body.append(button);\n'})}),"\n",(0,r.jsx)(n.h3,{id:"\ufe0f-measuring-the-performance-optional",children:"\u23f1\ufe0f Measuring the performance (optional)"}),"\n",(0,r.jsxs)(n.p,{children:["We'll use the ",(0,r.jsx)(n.a,{href:"https://github.com/mrdoob/stats.js",children:"Stats.js"})," to measure the performance of our app. We will add it to the top left corner of the viewport. This way, we'll make sure that the memory consumption and the FPS of our app are under control."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:'const stats = new Stats();\nstats.showPanel(2);\ndocument.body.append(stats.dom);\nstats.dom.style.left = "0px";\nstats.dom.style.zIndex = "unset";\nworld.renderer.onBeforeUpdate.add(() => stats.begin());\nworld.renderer.onAfterUpdate.add(() => stats.end());\n'})}),"\n",(0,r.jsx)(n.h3,{id:"-wrap-up",children:"\ud83c\udf89 Wrap up"}),"\n",(0,r.jsx)(n.p,{children:"That's it! Now you're able to use the Items Finder component to create powerful queries for your 3D models. Congratulations! Keep exploring more tutorials in the documentation to enhance your skills further."})]})}function m(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>a});var r=t(6540);const i={},s=r.createContext(i);function o(e){const n=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);