"use strict";(self.webpackChunkengine_docs=self.webpackChunkengine_docs||[]).push([[5648],{2163:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>d,frontMatter:()=>s,metadata:()=>r,toc:()=>h});var o=t(4848),i=t(8453);const s={},l=void 0,r={id:"Tutorials/Components/Front/Highlighter",title:"Highlighter",description:'window.open("https://thatopen.github.io/engine_components/examples/Highlighter")} >Go Full Screen',source:"@site/docs/Tutorials/Components/Front/Highlighter.mdx",sourceDirName:"Tutorials/Components/Front",slug:"/Tutorials/Components/Front/Highlighter",permalink:"/Tutorials/Components/Front/Highlighter",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"ClipStyler",permalink:"/Tutorials/Components/Front/ClipStyler"},next:{title:"Hoverer",permalink:"/Tutorials/Components/Front/Hoverer"}},a={},h=[{value:"\ud83d\udd26 Highlighting Items",id:"-highlighting-items",level:2},{value:"\ud83d\udd96 Importing our Libraries",id:"-importing-our-libraries",level:3},{value:"\ud83c\udf0e Setting up a Simple Scene",id:"-setting-up-a-simple-scene",level:3},{value:"\ud83d\udee0\ufe0f Setting Up Fragments",id:"\ufe0f-setting-up-fragments",level:3},{value:"\ud83d\udcc2 Loading Fragments Models",id:"-loading-fragments-models",level:3},{value:"\u2728 Using The Highlighter Component",id:"-using-the-highlighter-component",level:3},{value:"\ud83c\udfa8 Creating Custom Highlights",id:"-creating-custom-highlights",level:3},{value:"\ud83e\udde9 Adding some UI (optional but recommended)",id:"-adding-some-ui-optional-but-recommended",level:3},{value:"\u23f1\ufe0f Measuring the performance (optional)",id:"\ufe0f-measuring-the-performance-optional",level:3},{value:"\ud83c\udf89 Wrap up",id:"-wrap-up",level:3}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",hr:"hr",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{style:{position:"relative"},children:[(0,o.jsx)("iframe",{src:"https://thatopen.github.io/engine_components/examples/Highlighter"}),(0,o.jsx)("button",{class:"full-screen-btn",onClick:()=>window.open("https://thatopen.github.io/engine_components/examples/Highlighter"),children:"Go Full Screen"})]}),"\n",(0,o.jsx)(n.admonition,{title:"Source",type:"info",children:(0,o.jsxs)(n.p,{children:["Copying and pasting? We've got you covered! You can find the full source code of this tutorial ",(0,o.jsx)(n.a,{href:"https://github.com/ThatOpen/engine_components/blob/main/packages/front/src/fragments/Highlighter/example.ts",children:"here"}),"."]})}),"\n",(0,o.jsx)(n.h2,{id:"-highlighting-items",children:"\ud83d\udd26 Highlighting Items"}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.p,{children:"In 3D apps, users get some feedback when they hover or click on an object. Generally, it changes its color or shading. In this tutorial, you'll learn how to do that with the highlighter."}),"\n",(0,o.jsx)(n.admonition,{title:"Highlighting?",type:"tip",children:(0,o.jsx)(n.p,{children:"Highlighting means changing the color of one or many objects to make them stand out. This can be used for hovering, for selection, for bringing the attention of the user to certain items, etc."})}),"\n",(0,o.jsx)(n.h3,{id:"-importing-our-libraries",children:"\ud83d\udd96 Importing our Libraries"}),"\n",(0,o.jsx)(n.p,{children:"First things first, let's install all necessary dependencies to make this example work:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'import * as THREE from "three";\nimport Stats from "stats.js";\nimport * as OBC from "@thatopen/components";\nimport * as BUI from "@thatopen/ui";\n// You have to import * as OBF from "@thatopen/components-front"\nimport * as OBF from "../..";\n'})}),"\n",(0,o.jsx)(n.h3,{id:"-setting-up-a-simple-scene",children:"\ud83c\udf0e Setting up a Simple Scene"}),"\n",(0,o.jsx)(n.p,{children:"To get started, let's set up a basic ThreeJS scene. This will serve as the foundation for our application and allow us to visualize the 3D models effectively:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'const components = new OBC.Components();\n\nconst worlds = components.get(OBC.Worlds);\nconst world = worlds.create<\n  OBC.SimpleScene,\n  OBC.OrthoPerspectiveCamera,\n  OBF.PostproductionRenderer\n>();\n\nworld.scene = new OBC.SimpleScene(components);\nworld.scene.setup();\nworld.scene.three.background = null;\n\nconst container = document.getElementById("container")!;\nworld.renderer = new OBF.PostproductionRenderer(components, container);\nworld.camera = new OBC.OrthoPerspectiveCamera(components);\nawait world.camera.controls.setLookAt(68, 23, -8.5, 21.5, -5.5, 23);\n\ncomponents.init();\n'})}),"\n",(0,o.jsx)(n.h3,{id:"\ufe0f-setting-up-fragments",children:"\ud83d\udee0\ufe0f Setting Up Fragments"}),"\n",(0,o.jsx)(n.p,{children:"Now, let's configure the FragmentsManager. This will allow us to load models effortlessly and start manipulating them with ease:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'const workerUrl =\n  "https://thatopen.github.io/engine_fragment/resources/worker.mjs";\nconst fragments = components.get(OBC.FragmentsManager);\nfragments.init(workerUrl);\n\nworld.camera.controls.addEventListener("rest", () =>\n  fragments.core.update(true),\n);\n\nworld.onCameraChanged.add((camera) => {\n  for (const [, model] of fragments.list) {\n    model.useCamera(camera.three);\n  }\n  fragments.core.update(true);\n});\n\nfragments.list.onItemSet.add(({ value: model }) => {\n  model.useCamera(world.camera.three);\n  world.scene.three.add(model.object);\n  fragments.core.update(true);\n});\n'})}),"\n",(0,o.jsx)(n.h3,{id:"-loading-fragments-models",children:"\ud83d\udcc2 Loading Fragments Models"}),"\n",(0,o.jsx)(n.p,{children:"With the core setup complete, it's time to load a Fragments model into our scene. Fragments are optimized for fast loading and rendering, making them ideal for large-scale 3D models."}),"\n",(0,o.jsx)(n.admonition,{title:"Where can I find Fragment files?",type:"info",children:(0,o.jsx)(n.p,{children:"You can use the sample Fragment files available in our repository for testing. If you have an IFC model you'd like to convert to Fragments, check out the IfcImporter tutorial for detailed instructions."})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'const fragPaths = ["https://thatopen.github.io/engine_components/resources/frags/school_arq.frag"];\nawait Promise.all(\n  fragPaths.map(async (path) => {\n    const modelId = path.split("/").pop()?.split(".").shift();\n    if (!modelId) return null;\n    const file = await fetch(path);\n    const buffer = await file.arrayBuffer();\n    return fragments.core.load(buffer, { modelId });\n  }),\n);\n'})}),"\n",(0,o.jsx)(n.h3,{id:"-using-the-highlighter-component",children:"\u2728 Using The Highlighter Component"}),"\n",(0,o.jsx)(n.p,{children:"Next, we'll configure the highlighter component. The setup process is straightforward and can be done as follows:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'components.get(OBC.Raycasters).get(world);\n\nconst highlighter = components.get(OBF.Highlighter);\nhighlighter.setup({\n  world,\n  selectMaterialDefinition: {\n    // you can change this to define the color of your highligthing\n    color: new THREE.Color("#bcf124"),\n    opacity: 1,\n    transparent: false,\n    renderedFaces: 0,\n  },\n});\n'})}),"\n",(0,o.jsx)(n.p,{children:'The highlighter creates a built-in "select" type by default, which activates when the user clicks on an object. Selected elements change color to indicate selection and can be deselected automatically. You can listen for selection or deselection events to perform additional actions, such as retrieving element information. Let\'s proceed as follows:'}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'// You can handle the event callback as needed.\n// For example, here we retrieve the attributes of the selected items.\nhighlighter.events.select.onHighlight.add(async (modelIdMap) => {\n  console.log("Something was selected");\n\n  const promises = [];\n  for (const [modelId, localIds] of Object.entries(modelIdMap)) {\n    const model = fragments.list.get(modelId);\n    if (!model) continue;\n    promises.push(model.getItemsData([...localIds]));\n  }\n\n  const data = (await Promise.all(promises)).flat();\n  console.log(data);\n});\n\nhighlighter.events.select.onClear.add(() => {\n  console.log("Selection was cleared");\n});\n'})}),"\n",(0,o.jsx)(n.p,{children:"Pretty cool, right? But there's more!"}),"\n",(0,o.jsx)(n.h3,{id:"-creating-custom-highlights",children:"\ud83c\udfa8 Creating Custom Highlights"}),"\n",(0,o.jsx)(n.p,{children:"The highlighter component allows you to create additional highlighters to customize the color of items as needed. For instance, you might want to change colors based on specific attributes or any criteria you choose. The first step is to define the highlighter style:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'const customHighlighterName = "Red";\n\nhighlighter.styles.set(customHighlighterName, {\n  color: new THREE.Color("red"),\n  opacity: 1,\n  transparent: false,\n  renderedFaces: 0,\n});\n\n// You can also listen to highligth events\n// with custom styles\nhighlighter.events[customHighlighterName].onHighlight.add((map) => {\n  console.log("Highligthed with red", map);\n});\n\nhighlighter.events[customHighlighterName].onClear.add((map) => {\n  console.log("Red highlighter cleared", map);\n});\n'})}),"\n",(0,o.jsx)(n.p,{children:"The select highlighter takes precedence over custom highlighters. When an item is colorized with a custom highlighter and then selected, it will display the select highlighter's color until deselected. Let's create a function to apply the custom highlighter to selected elements and observe this behavior."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'const applyCustomHighlight = async () => {\n  if (!highlighter.styles.has(customHighlighterName)) return;\n  const selection = highlighter.selection.select;\n  if (OBC.ModelIdMapUtils.isEmpty(selection)) return;\n  await highlighter.highlightByID(customHighlighterName, selection, false);\n\n  // If you want the selection to become empty after it is colorized\n  // with the custom highlighter, add the following code:\n  // await highlighter.clear("select");\n};\n'})}),"\n",(0,o.jsx)(n.p,{children:"Let's also create a function to clear the custom highlighter, allowing the items to return to their original color (unless they are selected):"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'const resetCustomHighlighter = async (onlySelected = true) => {\n  if (!highlighter.styles.has(customHighlighterName)) return;\n  const modelIdMap = highlighter.selection.select;\n  await highlighter.clear(\n    customHighlighterName,\n    onlySelected ? modelIdMap : undefined,\n  );\n\n  // Just for demo purposes, let\'s also deselect the elements\n  await highlighter.clear("select");\n};\n'})}),"\n",(0,o.jsx)(n.h3,{id:"-adding-some-ui-optional-but-recommended",children:"\ud83e\udde9 Adding some UI (optional but recommended)"}),"\n",(0,o.jsxs)(n.p,{children:["We will use the ",(0,o.jsx)(n.code,{children:"@thatopen/ui"})," library to add some simple and cool UI elements to our app. First, we need to call the ",(0,o.jsx)(n.code,{children:"init"})," method of the ",(0,o.jsx)(n.code,{children:"BUI.Manager"})," class to initialize the library:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"BUI.Manager.init();\n"})}),"\n",(0,o.jsx)(n.p,{children:"Now we will add some UI to play around with the actions in this tutorial. For more information about the UI library, you can check the specific documentation for it!"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'const panel = BUI.Component.create<BUI.PanelSection>(() => {\n  return BUI.html`\n    <bim-panel active label="Highlighter Tutorial" class="options-menu">\n      <bim-panel-section label="Controls">\n        <bim-label>Click: single-selection</bim-label>\n        <bim-label>Ctrl + click: multi-selection</bim-label>\n      </bim-panel-section>\n      <bim-panel-section label="Actions">\n        <bim-label style="white-space: normal; width: 14rem;">Select some items, click the apply button, and then deselect them again to see the color applied</bim-label>\n        <bim-button @click=${applyCustomHighlight} label="Apply ${customHighlighterName}"></bim-button>\n        <bim-label style="white-space: normal; width: 14rem;">Select some item colored with red and apply the button. Then, deselect it to </bim-label>\n        <bim-button @click=${resetCustomHighlighter} label="Reset ${customHighlighterName}"></bim-button>\n      </bim-panel-section>\n    </bim-panel>\n  `;\n});\n\ndocument.body.append(panel);\n'})}),"\n",(0,o.jsx)(n.p,{children:"And we will make some logic that adds a button to the screen when the user is visiting our app from their phone, allowing to show or hide the menu. Otherwise, the menu would make the app unusable."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'const button = BUI.Component.create<BUI.PanelSection>(() => {\n  return BUI.html`\n      <bim-button class="phone-menu-toggler" icon="solar:settings-bold"\n        @click="${() => {\n          if (panel.classList.contains("options-menu-visible")) {\n            panel.classList.remove("options-menu-visible");\n          } else {\n            panel.classList.add("options-menu-visible");\n          }\n        }}">\n      </bim-button>\n    `;\n});\n\ndocument.body.append(button);\n'})}),"\n",(0,o.jsx)(n.h3,{id:"\ufe0f-measuring-the-performance-optional",children:"\u23f1\ufe0f Measuring the performance (optional)"}),"\n",(0,o.jsxs)(n.p,{children:["We'll use the ",(0,o.jsx)(n.a,{href:"https://github.com/mrdoob/stats.js",children:"Stats.js"})," to measure the performance of our app. We will add it to the top left corner of the viewport. This way, we'll make sure that the memory consumption and the FPS of our app are under control."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'const stats = new Stats();\nstats.showPanel(2);\ndocument.body.append(stats.dom);\nstats.dom.style.left = "0px";\nstats.dom.style.zIndex = "unset";\nworld.renderer.onBeforeUpdate.add(() => stats.begin());\nworld.renderer.onAfterUpdate.add(() => stats.end());\n'})}),"\n",(0,o.jsx)(n.h3,{id:"-wrap-up",children:"\ud83c\udf89 Wrap up"}),"\n",(0,o.jsx)(n.p,{children:"That's it! Now you're able to highlight objects in your 3D scene, customize highlight styles, and interact with selections using the highlighter component. Congratulations! Keep going with more tutorials in the documentation."})]})}function d(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>l,x:()=>r});var o=t(6540);const i={},s=o.createContext(i);function l(e){const n=o.useContext(s);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),o.createElement(s.Provider,{value:n},e.children)}}}]);